<chapter xml:id="Development_XTA"
	 xmlns:xlink="http://www.w3.org/1999/xlink">
  <title>Developing Application Programs using XTA (XA Transaction API) interface</title>
  <para>
    This chapter explains what XTA is and how you can develop applications
    that use XTA interface.
  </para>
  <section>
    <title>XTA Introduction</title>
    <para>
      This section introduces some basic concepts for a better comprehension of
      XTA topic.
    </para>
    <section>
      <title>Why XTA?</title>
      <para>
	The TX Transaction Demarcation Specification
	<citation>TXspec</citation>, published in 1995 by
	X/Open is a programming interface that has been designed for:
	<itemizedlist mark='bullet'>
	  <listitem><para>
	    C and COBOL programming languages
	  </para></listitem>
	  <listitem><para>
	    single thread applications
	  </para></listitem>
	  <listitem><para>
	    applications executed under the control of TP Monitors
	  </para></listitem>
	  <listitem><para>
	    implicit (static) transactional context
	  </para></listitem>
	</itemizedlist>
      </para>
      <para>
	The DTP Reference Model Version 3
	<citation>RefModel</citation>, published in 1996 by X/Open is a
	programming model that has been designed for:
	<itemizedlist mark='bullet'>
	  <listitem><para>
	    applications executed under the control of TP Monitors
	  </para></listitem>
	  <listitem><para>
	    TP Monitors with integrated Transaction Managers
	  </para></listitem>
	  <listitem><para>
	    tight coupling between couples of Transaction Managers to propagate
	    transactional contexts and to coordinated distributed transactions
	    among different systems
	  </para></listitem>
	</itemizedlist>
      </para>
      <para>
	All the above assumptions are no more up-to-date in the cloud native
	programming models like CaaS (Container as a Service), 
	PaaS (Platform as a Service) and FaaS (Function as a Service).
      </para>
      <para>
	XTA aims to provide TXaaS (Transaction as a Service) backend services
	that can be used by cloud native applications that, for one reason or
	another, require two phase commit ACID transactions among distributed
	applications
	<footnote><para>
	  Many authors consider two phase commit the root of every evil in
	  the realm of massively distributed applications, but the author of
	  XTA thinks that some specific use cases can take advantage from 
	  two phase commit transactionality
	</para></footnote>.
      </para>
    </section>
    <section>
      <title>XTA Architecture</title>
      <para>
	<figure xml:id="xta_arch01">
	  <title>Software stack of an XTA application</title>
	  <mediaobject>
	    <imageobject>
	      <imagedata fileref="../images/LIXA_Development_XTA_01.svg"/>
	    </imageobject>
	  </mediaobject>
	</figure>
	The above picture explains the software stack architecture for an XTA
	application: the <emphasis>Application Program</emphasis> interacts
	with XA <emphasis>Resource Managers</emphasis>, like PostgreSQL and
	MySQL, and with <emphasis>XTA</emphasis>.
	<emphasis>XTA</emphasis> wraps <emphasis>LIXA</emphasis> libraries that
	interact with the <emphasis>Resource Managers</emphasis> and implement
	the client side part of the transaction management logic.
      </para>
      <para>
	<figure xml:id="xta_arch02">
	  <title>Single application layout</title>
	  <mediaobject>
	    <imageobject>
	      <imagedata fileref="../images/LIXA_Development_XTA_02.svg"/>
	    </imageobject>
	  </mediaobject>
	</figure>
	The simplest deployment of an XTA application consists of a single
	<emphasis>Application Program</emphasis> that uses one or more
	<emphasis>Resource Managers</emphasis> in a distributed transaction.
	<emphasis>XTA</emphasis> connects to <emphasis>LIXA state server
	(<command>lixad</command>)</emphasis> to coordinate the XA two phase
	commit protocol.
	<emphasis>Application Program</emphasis>,
	<emphasis>Resource Managers</emphasis> and
	<emphasis>LIXA state server</emphasis> don't have to reside in the
	same system: they can be distributed in different systems that
	communicate by mean of the TCP/IP protocol.
      </para>
      <para>
	<figure xml:id="xta_arch03">
	  <title>Multiple applications layout</title>
	  <mediaobject>
	    <imageobject>
	      <imagedata fileref="../images/LIXA_Development_XTA_03.svg"/>
	    </imageobject>
	  </mediaobject>
	</figure>
	XTA allows deployment of multiple
	<emphasis>Application Programs</emphasis> that use one or more
	<emphasis>Resource Managers</emphasis> in a distributed transaction.
	<emphasis>XTA</emphasis> connects to <emphasis>LIXA state server
	(<command>lixad</command>)</emphasis> to coordinate the XA two phase
	commit protocol.
	<emphasis>Application Programs</emphasis>,
	<emphasis>Resource Managers</emphasis> and
	<emphasis>LIXA state server</emphasis> don't have to reside in the
	same system: they can be distributed in different systems that
	communicate by mean of the TCP/IP protocol.
      </para>
      <note>
	<para>
	  <emphasis>XTA</emphasis>, in comparison with the standard TX
	  interface, implements the logic necessary to distribute a
	  global transaction between two or more
	  <emphasis>Application Programs</emphasis> but it does not provide
	  the communication protocol between them. Using the above picture as
	  an example, it's in charge of
	  <emphasis>Application Program 1</emphasis> to exchange information
	  with <emphasis>Application Program 2</emphasis>: any synchronous or
	  asynchronous protocol can be used.
	</para>
	<para>
	  Anyway, two constraints can't be violated:
	  <itemizedlist mark='bullet'>
	    <listitem><para>
	      all the <emphasis>Application Programs</emphasis> that
	      participate in the same global transaction, must connect to the
	      same <emphasis>LIXA state server</emphasis>
	    </para></listitem>
	    <listitem><para>
	      the <emphasis>Application Programs</emphasis> must call XTA
	      functions in the proper order to participate in the same global
	      transaction
	    </para></listitem>
	  </itemizedlist>
	</para>
	<para>
	  XTA does not constraint many other aspects:
	  <itemizedlist mark='bullet'>
	    <listitem><para>
	      <emphasis>Application Programs</emphasis> don't have to be
	      developed using the same programming language
	    </para></listitem>
	    <listitem><para>
	      <emphasis>Application Programs</emphasis> don't have to be
	      executed inside the same sort of <emphasis>application
	      container or server</emphasis>; example: one
	      <emphasis>Application Program</emphasis> can be executed inside
	      a shell script, another one can be executed under the supervision
	      of an HTTP server
	    </para></listitem>
	    <listitem><para>
	      <emphasis>Application Programs</emphasis> can use any sort of
	      communication channel to transfer the transaction identifier 
	      (XID): it can be a REST over HTTP, it can be a message queing
	      system, it can be a POSIX pipe and so on. Any communication
	      channel that can send an ASCII string is eligible for passing
	      the transaction identifier (XID)
	    </para></listitem>
	    <listitem><para>
	      <emphasis>Application Programs</emphasis> can be called using
	      consecutive calls or can run in concurrent branches
	    </para></listitem>
	  </itemizedlist>
	</para>
      </note>
      <important>
	<para>
	  Not all Resource Managers can be used in all the possible
	  configurations that can be inferred from
	  <xref linkend="xta_arch03"/>; further details will be provided in the
	  next sections of this chapter.
	</para>
      </important>
    </section>
    <section xml:id="XTA_Technology_Matrix">
      <title>XTA Technology Matrix</title>
      <para>
	XTA strongly depends from the type of XA support provided by the
	different Resource Managers and from the language bindings supplied
	with the Resource Managers' libraries. The following table is updated
	with the tested configurations:
	<footnote><para>
	  Sometimes software versions make the difference, but this table don't
	  cope with them and must not be intended like a compatibility and
	  support matrix.
	</para></footnote>
	<table xml:id="XTA_technology_matrix" frame="all">
	  <title>Resouce Managers and Programming Languages for XTA</title>
	  <tgroup cols="6" colsep="1" rowsep="1">
	    <thead>
	      <row>
		<entry>Resource Manager</entry>
		<entry>C</entry>
		<entry>C++</entry>
		<entry>Java<footnote>
		<para>Planned a JNI based wrapper with access to XA native
		Java classes, not yet implemented
		</para></footnote></entry>
		<entry>PHP<footnote>
		<para>Planned a SWIG wrapper, not yet implemented
		</para></footnote></entry>
		<entry>Python</entry>
	      </row>
	    </thead>
	    <tbody align="center">
	      <row>
		<entry>MySQL, MariaDB<footnote>
		<para><quote>Multiple Applications, Consecutive Calls</quote>
		pattern is not
		available because MySQL/MariaDB doesn't support TMSUSPEND and
		TMRESUME standard XA flags
		</para></footnote></entry>
		<entry>Y</entry>
		<entry>Y</entry>
		<entry>-</entry>
		<entry>-</entry>
		<entry>Y<footnote>
		<para>The MySQLdb driver provided by mysqlclient-python project
		must be used: the first version that support XTA is provided
		by commit 
		<link xlink:href="https://github.com/PyMySQL/mysqlclient-python/commit/54c69436f45f2c78b3ace754780a1a265e60d430">54c69436f45f2c78b3ace754780a1a265e60d430</link>.
		</para></footnote></entry>
	      </row>
	      <row>
		<entry>Oracle DBMS</entry>
		<entry>Y</entry>
		<entry>Y</entry>
		<entry>-</entry>
		<entry>N<footnote>
		<para>No known way to re-use a standard OCI connection as an 
		XA OCI connection
		</para></footnote></entry>
		<entry>N<footnote>
		<para>No known way to re-use a standard OCI connection as an 
		XA OCI connection
		</para></footnote></entry>
	      </row>
	      <row>
		<entry>PostgreSQL<footnote>
		<para><quote>Multiple Applications, Consecutive Calls</quote>
		pattern is not
		available because PostgreSQL doesn't support TMSUSPEND and
		TMRESUME standard XA flags
		</para></footnote></entry>
		<entry>Y</entry>
		<entry>Y</entry>
		<entry>-</entry>
		<entry>-</entry>
		<entry>Y<footnote>
		<para>Psycopg2 driver must be used. A patched version of the
		source code is available in this
		<link xlink:href="https://github.com/tiian/psycopg2/tree/get-native-connection">github fork</link>. It should be part of Psycopg 2.8
		</para></footnote>
		</entry>
	      </row>
	    </tbody>
	  </tgroup>
	</table>
      </para>
    </section>
    <section>
      <title>The XTA Programming Model</title>
      <para>
	XTA support 4 different patterns:
	<itemizedlist mark='bullet'>
	  <listitem><para>
	    <quote>Single Application</quote>:
	    single <emphasis>Application Program</emphasis> with single or 
	    multiple <emphasis>Resource Managers</emphasis> as supported by
	    the TX Transaction Demarcation Specification
	  </para></listitem>
	  <listitem><para>
	    <quote>Multiple Applications, Consecutive Calls</quote>:
	    multiple <emphasis>Application Programs</emphasis> with single or
	    multiple <emphasis>Resource Managers</emphasis>, only one
	    <emphasis>Application Program</emphasis> is working as part of a
	    transaction at a specified time, the XA global transaction is
	    composed by a single transaction branch
	  </para></listitem>
	  <listitem><para>
	    <quote>Multiple Applications, Concurrent Branches/Pseudo
	    Synchronous</quote>:
	    multiple <emphasis>Application Programs</emphasis> with single or
	    multiple <emphasis>Resource Managers</emphasis>, many 
	    <emphasis>Application Programs</emphasis> are concurrently working
	    as part of a transaction at a specified time, the XA global
	    transaction is composed by multiple transaction branches, the
	    type of interaction among the
	    <emphasis>Application Programs</emphasis> is
	    <quote>Pseudo Synchronous</quote>
	  </para></listitem>
	  <listitem><para>
	    <quote>Multiple Applications, Concurrent Branches/Pseudo
	    Asynchronous</quote>:
	    multiple <emphasis>Application Programs</emphasis> with single or
	    multiple <emphasis>Resource Managers</emphasis>, many 
	    <emphasis>Application Programs</emphasis> are concurrently working
	    as part of a transaction at a specified time, the XA global
	    transaction is composed by multiple transaction branches, the
	    type of interaction among the
	    <emphasis>Application Programs</emphasis> is
	    <quote>Pseudo Asynchronous</quote>
	  </para></listitem>
	</itemizedlist>
      </para>
    </section>
    <section>
      <title>XTA Resources and XA Resource Managers</title>
      <important><para>
	This section refers to concepts that are linked with deep technical
	details of the <citation>XAspec</citation>: they are not trivial and
	sometimes they could even sound strange due to the epoch of XA
	standard design. XTA tries to provide an easy and modern interface for
	working with XA, but some caveats still remain at least for these
	reasons:
	<itemizedlist mark='bullet'>
	  <listitem><para>
	    XA was designed as a protocol between one 
	    <emphasis>Transaction Manager</emphasis> and one or more
	    <emphasis>Resource Managers</emphasis>; the designers probably
	    didn't imagine the usage of XA inside something like XTA
	  </para></listitem>
	  <listitem><para>
	    XA standard predated the free software and open source initiatives
	    and the design had to cope with commercial closed source softwares.
	    Furthermore, XA didn't introduce changes in the proprietary 
	    protocols between
	    <emphasis>Application Programs</emphasis> and 
	    <emphasis>Resource Managers</emphasis>, but <quote>sidecar</quote>
	    approach was choosen.
	  </para></listitem>
	</itemizedlist>
      </para></important>
      <section>
	<title>XA Design Considerations</title>
	<para>
	  <citation>XAspec</citation> defines the interface that must be
	  implemented by an <quote>XA standard compliant</quote>
	  <emphasis>Resource Manager</emphasis>: it's described in file
	  <link xlink:href="https://github.com/tiian/lixa/blob/master/src/common/xa.h">xa.h</link> by struct <function>xa_switch_t</function>.
	  One tricky point is a consequence of <function>xa_open()</function>
	  and <function>xa_close()</function> functions: they must be called to
	  <quote>open</quote> and <quote>close</quote> the 
	  <emphasis>Resource Manager</emphasis>. 
	</para>
	<para>
	  Non XA applications use native functions to open and close the
	  connections with the resource managers.
	</para>
	<para>
	  <emphasis>Application Programs</emphasis> that run in a XA context,
	  must retrieve the connections with the 
	  <emphasis>Resource Managers</emphasis> previously opened by the
	  <emphasis>Transaction Manager</emphasis>.	
	</para>
	<para>
	  During LIXA development, 3 different type of
	  <emphasis>Resource Managers</emphasis> have been discovered:
	  <itemizedlist mark='bullet'>
	    <listitem><para>
	      XA standard compliant <emphasis>Resource Managers</emphasis> that
	      implement <function>xa_switch_t</function> interface and use the
	      exact same functions to open a new connection and to retrieve a
	      connection previously opened by the
	      <emphasis>Transaction Manager</emphasis>: IBM DB2 and IBM MQ
	      (previously MQSeries and WebSphere MQ) belong to this category
	      <footnote><para>IBM, DB2, MQ, MQSeries and WebSphere are
	      trademarks of <trademark>IBM</trademark></para></footnote>
	    </para></listitem>
	    <listitem><para>
	      XA standard compliant <emphasis>Resource Managers</emphasis> that
	      implement <function>xa_switch_t</function> interface and use
	      different functions to open a new connection and to retrieve a
	      connection previously opened by the
	      <emphasis>Transaction Manager</emphasis>: Oracle Database Server
	      belongs to this category
	      <footnote><para>Oracle is a trademark of
	      <trademark>Oracle Corporation</trademark></para></footnote>
	    </para></listitem>
	    <listitem><para>
	      Non XA standard compliant <emphasis>Resource Managers</emphasis>
	      that don't implement <function>xa_switch_t</function> interface
	      and provide some XA equivalent functions by mean of special
	      commands: MySQL<footnote><para>MySQL is a trademark of
	      <trademark>Oracle Corporation</trademark></para></footnote>,
	      MariaDB and PostgreSQL belong to this category
	    </para></listitem>
	  </itemizedlist>
	</para>
	<para>
	  The second type of <emphasis>Resource Managers</emphasis> is the
	  most difficult to integrate from XTA perspective: next paragraphs
	  explain why.
	</para>
      </section>
      <section>
	<title>XTA Resource Hierarchy</title>
	<para>
	  To cope with the different implementations of XA 
	  <emphasis>Resource Managers</emphasis>, XTA introduces a specific
	  hierarchy for resources as depicted in the below image:
	  <figure xml:id="xta_arch05">
	  <title>XTA Resource Hierarchy</title>
	  <mediaobject>
	    <imageobject>
	      <imagedata fileref="../images/LIXA_Development_XTA_05.svg"/>
	    </imageobject>
	  </mediaobject>
	  </figure>
	</para>
	<para>
	  <emphasis>XAResource</emphasis> is an abstract class that can't be
	  used to map a real <emphasis>Resource Manager</emphasis>, but
	  useful to pass an object reference.
	</para>
	<para>
	  <emphasis>NativeXAResource</emphasis> is the concrete class that
	  must be used for all the <emphasis>Resource Managers</emphasis>
	  that provide XA standard interface.
	</para>
	<para>
	  <emphasis>AcquiredXAResource</emphasis> is a partially abstract
	  class with basically no practical use (only conceptual).
	</para>
	<para>
	  <emphasis>MySQLXAResource</emphasis> is the concrete class that 
	  must be used for MySQL and MariaDB
	  <emphasis>Resource Managers</emphasis>: it implements a specific
	  constructor that accepts a MYSQL type connection.
	</para>
	<para>
	  <emphasis>PostgreSQLXAResource</emphasis> is the concrete class that 
	  must be used for PostgreSQL <emphasis>Resource Manager</emphasis>:
	  it implements a specific constructor that accepts a PGconn type
	  connection.
	</para>
	<para>
	  Further non XA standard <emphasis>Resource Managers</emphasis> will
	  require specialized <emphasis>somethingXAResource</emphasis>.
	</para>
      </section>
      <section>
	<title>XTA Resource Usage</title>
	<para>
	  Due to the above explanation, the usage of the different XTA
	  resource types present some differences:
	  <itemizedlist mark='bullet'>
	    <listitem><para>
	      <emphasis>NativeXAResource</emphasis> can be statically defined
	      inside <filename>lixac_conf.xml</filename> or can be dynamically
	      defined at run time using the class constructor.
	    </para></listitem>
	    <listitem><para>
	      statically defined <emphasis>NativeXAResource</emphasis>
	      must be create (method <function>new</function>) after
	      <emphasis>Transaction Manager</emphasis> object creation
	    </para></listitem>
	    <listitem><para>
	      dynamically defined <emphasis>NativeXAResource</emphasis>
	      must be create (method <function>new</function>) before
	      <emphasis>Transaction Manager</emphasis> object creation
	    </para></listitem>
	    <listitem><para>
	      statically defined <emphasis>NativeXAResource</emphasis> can
	      be enlisted (method <function>enlist</function>), but it's not
	      necessary
	    </para></listitem>
	    <listitem><para>
	      dynamically defined <emphasis>NativeXAResource</emphasis>
	      and <emphasis>AcquiredXAResource</emphasis> must be enlisted
	      (method <function>enlist</function>) to participate in a
	      distributed <emphasis>Transaction</emphasis>
	    </para></listitem>
	  </itemizedlist>
	</para>
      </section>
    </section>
    <section>
      <title>XTA API Reference</title>
      <para>
	XTA API Reference is extracted from source code using
	<link xlink:href="http://www.doxygen.org/">Doxygen</link> tool.
	If you install <filename>doxygen</filename>, it will be produced
	during build phase and stored in directory
	<filename>doc/api/xta/html</filename>.
      </para>
      <para>
	XTA API Reference can be consulted online:
	<itemizedlist mark='bullet'>
	  <listitem><para>
	    C language:
	    <link xlink:href="http://www.tiian.org/lixa/manuals/xta/C/">
	    http://www.tiian.org/lixa/manuals/xta/C/</link>
	  </para></listitem>
	  <listitem><para>
	    C++ language:
	    <link xlink:href="http://www.tiian.org/lixa/manuals/xta/CPP/">
	    http://www.tiian.org/lixa/manuals/xta/CPP/</link>
	  </para></listitem>
	  <listitem><para>
	    Python language: the client binding is produced by 
	    <link xlink:href="http://www.swig.org/">SWIG</link> from the C++
	    interface; please look at C++ interface
	  </para></listitem>
	</itemizedlist>
      </para>
    </section>
  </section>
  <section>
    <title>The <quote>Single Application</quote> Pattern</title>
    <table frame="box">
      <thead>
	<tr><td>The pattern in brief:</td></tr>
      </thead>
      <tbody>
	<tr>
	  <td>Architecture:</td>
	  <td>see <xref linkend="xta_arch02"/></td>
	</tr>
	<tr>
	  <td>Number of Application Programs:</td>
	  <td>exactly 1</td>
	</tr>
	<tr>
	  <td>Number of Resource Managers:</td>
	  <td>many, if 1 single phase commit will be used</td>
	</tr>
	<tr>
	  <td>Number of Branches in the Gloabal Transaction:</td>
	  <td>exactly 1</td>
	</tr>
	<tr>
	  <td>Concurrency among Application Programs:</td>
	  <td>not applicable</td>
	</tr>
      </tbody>
    </table>
    <section>
      <title>Description</title>
      <para>
	This is a traditional Distributed Transaction Processing pattern: a
	single Application Program uses two or more Resource Managers and
	performs a transaction that change the state of both. Here is a list
	of examples:
	<itemizedlist mark='bullet'>
	  <listitem><para>
	    RM1 and RM2 are two different databases, for example PostgreSQL and
	    MySQL (or MariaDB): the Application Program moves a record from
	    RM1 (PostgreSQL) to RM2 (MySQL)
	  </para></listitem>
	  <listitem><para>
	    RM1 and RM2 are a messaging system and a database, for example
	    IBM MQ and Oracle Databae Server: the Application Program get a
	    message from a queue, insert a row in a table, remove the message
	    from the queue
	  </para></listitem>
	  <listitem><para>
	    RM1 and RM2 are two different types of database and the 
	    Application Program inserts exactly the same data in both, maybe
	    using a different format
	  </para></listitem>
	</itemizedlist>
	The pattern can be implemented even using the standard TX Transaction
	Demarcation interface, but XTA is much more object oriented.
      </para>
    </section>
    <section>
      <title>How it works</title>
      <figure xml:id="xta_pattern01">
	<title>Simplified sequence diagram for the <quote>Single Application
	Program</quote> Pattern</title>
	<mediaobject>
	  <imageobject>
	    <imagedata fileref="../images/LIXA_Development_XTA_04.svg"/>
	  </imageobject>
	</mediaobject>
      </figure>
      <para>
	The above figure shows the logic necessary to build this type of
	application; it's <emphasis>not</emphasis> a formally correct UML
	sequence diagram (all the XTA objects are in the same lifeline), but
	it should be clear enough to understand the
	proper operations sequence:
      </para>
      <itemizedlist mark='bullet'>
	<listitem><para>
	  The Application Program (AP) creates the native
	  objects/connections/handles
	  <footnote><para>
	    Examples: <function>mysql_real_connect</function> for MySQL,
	    <function>PQconnectDB</function> for PostgreSQL.
	  </para></footnote>
	  that are necessary to operate with the Resource Managers
	  <footnote><para>
	    Some Resource Managers, like for example Oracle Database Server,
	    don't allow to be created as <quote>normal</quote> connections
	    and then transformed in <emphasis>XA connections</emphasis>:
	    they must be directly created by XTA.
	  </para></footnote>
	</para></listitem>
	<listitem><para>
	  The AP creates some XTA objects: a
	  <function>TransactionManager</function>,
	  two <function>XaResource</function>
	  and one <function>Transaction</function>
	</para></listitem>
	<listitem><para>
	  The AP <quote>enlists</quote> the XA resources that 
	  <emphasis>must be controlled by the transaction</emphasis>
	  using <function>EnlistResource()</function> method
	</para></listitem>
	<listitem><para>
	  The AP uses the <function>Open()</function> method
	  to initialize the <function>XaResource</function> objects
	</para></listitem>
	<listitem><para>
	  The AP uses the <function>Start()</function> method
	  to start a new XA distributed transaction
	</para></listitem>
	<listitem><para>
	  The AP interacts with the Resource Managers, using the native
	  objects/connections/handles to operate
	  (<quote>doSomething</quote> method in the diagram)
	</para></listitem>
	<listitem><para>
	  The AP uses the <function>Commit()</function> method to commit the
	  distributed transaction, or the <function>Rollback()</function>
	  method to rollback all the changes since
	  <function>Start()</function>
	</para></listitem>
	<listitem><para>
	  The AP cleans-up the environment
	</para></listitem>
      </itemizedlist>
      <note><para>
	The dashed red rectangle highlights the XA global transaction.
      </para></note>
      <note><para>
	The methods listed in the above description must be considered
	<quote>pseudo-code</quote>: the real name and signature is language
	dependent. As an example, 
	<screen>tm = new TransactionManager()</screen> translates to
	<screen>tm = xta_transaction_manager_new()</screen> and
	<screen>tx.Commit()</screen> translates to
	<screen>xta_transaction_commit(tx, FALSE)</screen> in C.
      </para></note>
    </section>
    <section>
      <title>Example using C language</title>
      <para>
	The supplied example (<filename>example_xta_sa01.c</filename>) uses
	PostgreSQL in the role of <quote>Resource Manager 1</quote> and MySQL
	(or MariaDB) in the role of <quote>Resource Manager 2</quote>; please
	refer to the instructions explained :
	<itemizedlist mark="bullet">
	  <listitem><para>
	    in <xref linkend="App_RM_Config_MySQL"/>
	    to set-up a running environment for MySQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="App_RM_Config_PostgreSQL"/>
	    to set-up a running environment for PostgreSQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="Starting_the_state_server"/>
	    to start up the LIXA state server
	  </para></listitem>
	</itemizedlist>
      </para>
      <para>
	Create a working directory in a place you are comfortable with:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	Copy file <filename>example_xta_sa01.c</filename> in your working dir:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/example_xta_sa01.c .
	  </screen></td></tr></tbody>
	</table>
	Substitute <quote>X.Y.Z</quote> with the actual version of
	the software you installed.
      </para>
      <para>
	Compile and link the C example program:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ . /opt/lixa/bin/lixa_env.sh 
tiian@ubuntu1404-64:~/tmp$ gcc example_xta_sa01.c $(lixa-config -x -c -f -l -d) -lpq $(mysql_config --libs_r) -o example_xta_sa01
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	If the previous steps worked for you, you should have an executable
	file of name <filename>example_xta_sa01</filename> in your current 
	directory:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:/tmp$ ls -l
total 32
-rwxrwxr-x 1 tiian tiian 18603 mar 20 22:56 example_xta_sa01
-rw-r--r-- 1 tiian tiian  8302 mar 20 22:50 example_xta_sa01.c
	  </screen></td></tr></tbody>
	</table>
	The example program accepts two arguments:
	<itemizedlist mark="bullet">
          <listitem><para>
	    commit (or rollback): use <quote>1</quote> if you want to perform
	    a global commit or <quote>0</quote> if you want to perform a global
	    rollback
	  </para></listitem>
          <listitem><para>
	    insert (or delete): use <quote>1</quote> if you want to insert rows
	    in databases or <quote>0</quote> if you want to delete rows from
	    databases
	  </para></listitem>
	</itemizedlist>
      </para>
      <para>
	Open three terminal sessions: one for example execution,
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -la
total 40
drwxrwxr-x  2 tiian tiian  4096 mar 20 23:13 .
drwxr-xr-x 12 tiian tiian  4096 mar 21 22:17 ..
-rwxrwxr-x  1 tiian tiian 18603 mar 20 23:13 example_xta_sa01
-rw-r--r--  1 tiian tiian  8302 mar 20 23:08 example_xta_sa01.c
	  </screen></td></tr></tbody>
	</table>
	one for PostgreSQL queries
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ psql testdb
psql (9.3.22)
Type "help" for help.

testdb=>
	  </screen></td></tr></tbody>
	</table>
	and one for MySQL queries
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 36
Server version: 5.5.59-0ubuntu0.14.04.1 (Ubuntu)

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql>
	  </screen></td></tr></tbody>
	</table>
	set <varname>LIXA_PROFILE</varname> environment variable to
	<constant>XTA_DYN</constant>
	a profile without static Resource Managers defined in
	<filename>lixac_conf.xml</filename>:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	insert rows in tables and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_sa01 1 1
PostgreSQL, executing &gt;INSERT INTO authors VALUES(1921, 'Rigoni Stern', 'Mario')&lt;
MySQL, executing &gt;INSERT INTO authors VALUES(1919, 'Levi', 'Primo')&lt;
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
+------+-----------+------------+
| id   | last_name | first_name |
+------+-----------+------------+
| 1919 | Levi      | Primo      |
+------+-----------+------------+
1 row in set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	delete rows from tables, but rollback:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_sa01 0 0
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql> select * from authors;
+------+-----------+------------+
| id   | last_name | first_name |
+------+-----------+------------+
| 1919 | Levi      | Primo      |
+------+-----------+------------+
1 row in set (0.00 sec)

mysql>
	  </screen></td></tr></tbody>
	</table>
	delete rows and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_sa01 1 0
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=> select * from authors;
 id | last_name | first_name 
----+-----------+------------
(0 rows)

testdb=>
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql> select * from authors;
Empty set (0.00 sec)

mysql>
	  </screen></td></tr></tbody>
	</table>
      </para>
      <section>
	<title>Source Code</title>
	<para>
	  Source code for program <filename>example_xta_sa01.c</filename> is
	  installed in directory
	  <filename>/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta</filename> and
	  is available on <link xlink:href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/example_xta_sa01.c">GitHub</link>. Source code is fully
	  commented for readability.
	</para>
      </section>
    </section>
    <section>
      <title>Example using C++ language</title>
      <para>
	The supplied example (<filename>example_xta_sa11.cpp</filename>) uses
	PostgreSQL in the role of <quote>Resource Manager 1</quote> and MySQL
	(or MariaDB) in the role of <quote>Resource Manager 2</quote>; please
	refer to the instructions explained :
	<itemizedlist mark="bullet">
	  <listitem><para>
	    in <xref linkend="App_RM_Config_MySQL"/>
	    to set-up a running environment for MySQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="App_RM_Config_PostgreSQL"/>
	    to set-up a running environment for PostgreSQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="Starting_the_state_server"/>
	    to start up the LIXA state server
	  </para></listitem>
	</itemizedlist>
      </para>
      <para>
	Create a working directory in a place you are comfortable with:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	Copy file <filename>example_xta_sa11.cpp</filename> in your working
	dir:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/cpp/example_xta_sa11.cpp .
	  </screen></td></tr></tbody>
	</table>
	Substitute <quote>X.Y.Z</quote> with the actual version of
	the software you installed.
      </para>
      <para>
	Compile and link the C++ example program:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ . /opt/lixa/bin/lixa_env.sh 
tiian@ubuntu1404-64:~/tmp$ g++ example_xta_sa11.cpp $(lixa-config -c -f -l -d --xta --language-cpp) -lpq $(mysql_config --libs_r) -o example_xta_sa11
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	If the previous steps worked for you, you should have an executable
	file of name <filename>example_xta_sa11</filename> in your current 
	directory:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l
total 36
-rwxrwxr-x 1 tiian tiian 25613 ago 24 22:19 example_xta_sa11
-rw-r--r-- 1 tiian tiian  7748 ago 24 22:19 example_xta_sa11.cpp
	  </screen></td></tr></tbody>
	</table>
	The example program accepts two arguments:
	<itemizedlist mark="bullet">
          <listitem><para>
	    commit (or rollback): use <quote>1</quote> if you want to perform
	    a global commit or <quote>0</quote> if you want to perform a global
	    rollback
	  </para></listitem>
          <listitem><para>
	    insert (or delete): use <quote>1</quote> if you want to insert rows
	    in databases or <quote>0</quote> if you want to delete rows from
	    databases
	  </para></listitem>
	</itemizedlist>
      </para>
      <para>
	Open three terminal sessions: one for example execution,
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -la
total 44
drwxrwxr-x  2 tiian tiian  4096 ago 24 22:19 .
drwxr-xr-x 12 tiian tiian  4096 ago 24 22:02 ..
-rwxrwxr-x  1 tiian tiian 25613 ago 24 22:19 example_xta_sa11
-rw-r--r--  1 tiian tiian  7748 ago 24 22:19 example_xta_sa11.cpp
	  </screen></td></tr></tbody>
	</table>
	one for PostgreSQL queries
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ psql testdb
psql (9.3.23)
Type "help" for help.

testdb=>
	  </screen></td></tr></tbody>
	</table>
	and one for MySQL queries
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 44
Server version: 5.5.61-0ubuntu0.14.04.1 (Ubuntu)

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql>
	  </screen></td></tr></tbody>
	</table>
	set <varname>LIXA_PROFILE</varname> environment variable to
	<constant>XTA_DYN</constant>
	a profile without static Resource Managers defined in
	<filename>lixac_conf.xml</filename>:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	insert rows in tables and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_sa11 1 1
PostgreSQL, executing &gt;INSERT INTO authors VALUES(1921, 'Rigoni Stern', 'Mario')&lt;
MySQL, executing &gt;INSERT INTO authors VALUES(1919, 'Levi', 'Primo')&lt;
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
+------+-----------+------------+
| id   | last_name | first_name |
+------+-----------+------------+
| 1919 | Levi      | Primo      |
+------+-----------+------------+
1 row in set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	delete rows from tables, but rollback:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_sa11 0 0
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql> select * from authors;
+------+-----------+------------+
| id   | last_name | first_name |
+------+-----------+------------+
| 1919 | Levi      | Primo      |
+------+-----------+------------+
1 row in set (0.00 sec)

mysql>
	  </screen></td></tr></tbody>
	</table>
	delete rows and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_sa11 1 0
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=> select * from authors;
 id | last_name | first_name 
----+-----------+------------
(0 rows)

testdb=>
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql> select * from authors;
Empty set (0.00 sec)

mysql>
	  </screen></td></tr></tbody>
	</table>
      </para>
      <section>
	<title>Source Code</title>
	<para>
	  Source code for program <filename>example_xta_sa11.cpp</filename> is
	  installed in directory
	  <filename>/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/cpp</filename> and
	  is available on <link xlink:href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/cpp/example_xta_sa11.cpp">GitHub</link>.
	  Source code is fully commented for readability.
	</para>
      </section>
    </section>
    <section>
      <title>Example using Python language</title>
      <para>
	The supplied example (<filename>example_xta_sa21.py</filename>) uses
	PostgreSQL in the role of <quote>Resource Manager 1</quote> and MySQL
	(or MariaDB) in the role of <quote>Resource Manager 2</quote>; please
	refer to the instructions explained :
	<itemizedlist mark="bullet">
	  <listitem><para>
	    in <xref linkend="XTA_Technology_Matrix"/>
	    to build and install the Python database drivers that can be used
	    with XTA
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="App_RM_Config_MySQL"/>
	    to set-up a running environment for MySQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="App_RM_Config_PostgreSQL"/>
	    to set-up a running environment for PostgreSQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="Starting_the_state_server"/>
	    to start up the LIXA state server
	  </para></listitem>
	</itemizedlist>
	The example can be used with Python 2 and Python 3.
      </para>
      <para>
	Create a working directory in a place you are comfortable with:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	Copy file <filename>example_xta_sa21.py</filename> in your working
	dir:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/python/example_xta_sa21.py .
	  </screen></td></tr></tbody>
	</table>
	Substitute <quote>X.Y.Z</quote> with the actual version of
	the software you installed.
      </para>
      <para>
	The example program accepts two arguments:
	<itemizedlist mark="bullet">
          <listitem><para>
	    commit (or rollback): use <quote>1</quote> if you want to perform
	    a global commit or <quote>0</quote> if you want to perform a global
	    rollback
	  </para></listitem>
          <listitem><para>
	    insert (or delete): use <quote>1</quote> if you want to insert rows
	    in databases or <quote>0</quote> if you want to delete rows from
	    databases
	  </para></listitem>
	</itemizedlist>
      </para>
      <para>
	Open three terminal sessions: one for example execution,
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -la
total 12
drwxrwxr-x  2 tiian tiian 4096 ott 15 22:08 .
drwxr-xr-x 16 tiian tiian 4096 ott 15 22:06 ..
-rw-r--r--  1 tiian tiian 3980 ott 15 22:08 example_xta_sa21.py
	  </screen></td></tr></tbody>
	</table>
	one for PostgreSQL queries
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ psql testdb
psql (9.3.24)
Type "help" for help.

testdb=>
	  </screen></td></tr></tbody>
	</table>
	and one for MySQL queries
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 44
Server version: 5.5.61-0ubuntu0.14.04.1 (Ubuntu)

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql>
	  </screen></td></tr></tbody>
	</table>
	set <varname>LIXA_PROFILE</varname> environment variable to
	<constant>XTA_DYN</constant>
	a profile without static Resource Managers defined in
	<filename>lixac_conf.xml</filename>:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	insert rows in tables and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ python example_xta_sa21.py 1 1
PostgreSQL, executing &gt;INSERT INTO authors VALUES(1921, 'Rigoni Stern', 'Mario')&lt;
MySQL, executing &gt;INSERT INTO authors VALUES(1919, 'Levi', 'Primo')&lt;
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
+------+-----------+------------+
| id   | last_name | first_name |
+------+-----------+------------+
| 1919 | Levi      | Primo      |
+------+-----------+------------+
1 row in set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	delete rows from tables, but rollback:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ python example_xta_sa21.py 0 0
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql> select * from authors;
+------+-----------+------------+
| id   | last_name | first_name |
+------+-----------+------------+
| 1919 | Levi      | Primo      |
+------+-----------+------------+
1 row in set (0.00 sec)

mysql>
	  </screen></td></tr></tbody>
	</table>
	delete rows and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ python example_xta_sa21.py 1 0
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=> select * from authors;
 id | last_name | first_name 
----+-----------+------------
(0 rows)

testdb=>
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql> select * from authors;
Empty set (0.00 sec)

mysql>
	  </screen></td></tr></tbody>
	</table>
      </para>
      <section>
	<title>Source Code</title>
	<para>
	  Source code for program <filename>example_xta_sa21.py</filename> is
	  installed in directory
	  <filename>/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/python</filename> and
	  is available on <link xlink:href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/python/example_xta_sa21.py">GitHub</link>.
	  Source code is fully commented for readability.
	</para>
      </section>
    </section>
  </section>
  <section>
    <title>The
    <quote>Multiple Applications, Consecutive Calls</quote>
    Pattern</title>
    <table frame="box">
      <thead>
	<tr><td>The pattern in brief:</td></tr>
      </thead>
      <tbody>
	<tr>
	  <td>Architecture:</td>
	  <td>see <xref linkend="xta_arch03"/></td>
	</tr>
	<tr>
	  <td>Number of Application Programs:</td>
	  <td>2 or more</td>
	</tr>
	<tr>
	  <td>Number of Resource Managers:</td>
	  <td>1 or more for every Application Program</td>
	</tr>
	<tr>
	  <td>Number of Branches in the Gloabal Transaction:</td>
	  <td>1 for every Application Program</td>
	</tr>
	<tr>
	  <td>Concurrency among Application Programs:</td>
	  <td>no, strictly consecutive executive</td>
	</tr>
      </tbody>
    </table>
    <section>
      <title>Description</title>
      <para>
	This is a Distributed Transaction Processing pattern introduced by XTA:
	two or more Application Programs use the same Resource Manager(s) and
	perform consecutive operations inside a single XA global transaction.
	The Resource Manager(s) must be able to suspend and resume the
	thread's association with the transaction
	branch: this feature is part of the XA standard, but some resource
	managers don't support it (for example MySQL, MariaDB and PostgreSQL).
      </para>
      <para>
	The following picture shows an example that can be implemented using
	Oracle RDBMS.
	<figure xml:id="xta_pattern06">
	  <title>Example of <quote>Multiple Applications, 
	  Consecutive Calls</quote> with two Application Programs and one
	  Resource Manager</title>
	  <mediaobject>
	    <imageobject>
	      <imagedata fileref="../images/LIXA_Development_XTA_06.svg"/>
	    </imageobject>
	  </mediaobject>
	</figure>
	The pattern can <emphasis>not</emphasis> be implemented using the
	standard TX Transaction	Demarcation interface
	<footnote><para>
	  Transaction Coupling (TC) TX extensions supports the pattern with
	  a traditional TX like interface
	  (see <xref linkend="Development_TC"/>)
	</para></footnote>.
      </para>
    </section>
    <section>
      <title>How it works</title>
      <figure xml:id="xta_pattern07">
	<title>Simplified sequence diagram for the
	<quote>Multiple Applications, Consecutive Calls</quote>
	Pattern</title>
	<mediaobject>
	  <imageobject>
	    <imagedata fileref="../images/LIXA_Development_XTA_07.svg"/>
	  </imageobject>
	</mediaobject>
      </figure>
      <para>
	The above figure shows the logic necessary to build this type of
	applications; it's <emphasis>not</emphasis> a formally correct UML
	sequence diagram (all the XTA objects are in the same lifeline), but
	it should be clear enough to understand the
	proper operations sequence:
      </para>
      <itemizedlist mark='bullet'>
	<listitem><para>
	  The first AP creates some XTA objects: a
	  <function>XaResource</function>, a
	  <function>TransactionManager</function>,
	  and one <function>Transaction</function>
	</para></listitem>
	<listitem><para>
	  The first AP <quote>enlists</quote> the XA resource that 
	  <emphasis>must be controlled by the transaction</emphasis>
	  using <function>EnlistResource()</function> method
	</para></listitem>
	<listitem><para>
	  The first AP uses the <function>Open()</function> method
	  to initialize the <function>XaResource</function> objects
	</para></listitem>
	<listitem><para>
	  The first AP uses the <function>Start()</function> method
	  to start a new XA distributed transaction
	</para></listitem>
	<listitem><para>
	  The first AP interacts with the Resource Manager using the native
	  objects/connections/handles to operate
	  (<quote>doSomething</quote> method in the diagram). The example is
	  based on Oracle DBMS: environment is retrieved with 
	  <function>xaoEnv()</function>, context is retrieved with
	  <function>xaoSvcCtx()</function> and connection handle is retrieved
	  with <function>OCIHandleAlloc</function>
	</para></listitem>
	<listitem><para>
	  The first AP <emphasis>suspends</emphasis> its thread's association
	  with the transaction using <function>Suspend()</function> method
	  and then it retrieves the Transaction Id (XID) using
	  <function>GetXid()</function> method
	</para></listitem>
	<listitem><para>
	  The first AP is now able to pass the Transaction Id (XID) to the
	  second AP: it can use any type of communication protocol able to
	  send an ASCII string
	</para></listitem>
	<listitem><para>
	  At this point, first AP terminates its processing and the second AP
	  takes the control of the transaction using
	  <function>Resume()</function> method
	</para></listitem>
	<listitem><para>
	  The second AP interacts with the Resource Manager using the native
	  objects/connections/handles to operate
	  (<quote>doSomething</quote> method in the diagram)
	</para></listitem>
	<listitem><para>
	  The second AP commit the transaction using
	  <function>Commit()</function> method (alternatively it could rollback
	  the transaction using <function>Rollback()</function> method)
	</para></listitem>
	<listitem><para>
	  The second AP terminates its processing
	</para></listitem>
      </itemizedlist>
      <note><para>
	The dashed red rectangle highlights the XA global transaction.
      </para></note>
      <important><para>
	These are the relevant elements of this pattern:
	<itemizedlist mark='bullet'>
	  <listitem><para>
	    The first Application Program starts a new Transaction, performs
	    some activities with the Resource Manager(s), suspends its
	    association with the Transaction and passes the XID to the second
	    Application Program
	  </para></listitem>
	  <listitem><para>
	    The second Application Program sets up its XTA objects, but it
	    does not start a new Transaction: it must wait the XID from the
	    first Application Program, resumes the Transaction and completes
	    the work
	  </para></listitem>
	  <listitem><para>
	    The pattern does <emphasis>not</emphasis> allow concurrent access
	    to the same Resource Manager(s): only one Application Program at a
	    time can be associated to the same global transaction
	  </para></listitem>
	  <listitem><para>
	    There's basically no limit to the number of different Application
	    Programs that consecutively participate into the Transaction
	  </para></listitem>
	  <listitem><para>
	    There's no constraint to the number of different programming
	    languages used: every Application Program can be developed using
	    a different programming language supported by XTA
	  </para></listitem>
	  <listitem><para>
	    There's no constraint to communication protocol used by 
	    Application Programs to exchange information: REST API, SOAP based
	    web services, CORBA, RPC, any network protocol, any inter process
	    communication, etc... XTA does <emphasis>not</emphasis> force the
	    developer to use a specific communication protocol: any technique
	    suitable to send an ASCII string can be used
	  </para></listitem>
	</itemizedlist>
      </para></important>
      <note><para>
	The methods listed in the above description must be considered
	<quote>pseudo-code</quote>: the real name and signature is language
	dependent. As an example, 
	<screen>tm = new TransactionManager()</screen> translates to
	<screen>tm = xta_transaction_manager_new()</screen> and
	<screen>tx.Commit()</screen> translates to
	<screen>xta_transaction_commit(tx, FALSE)</screen> in C.
      </para></note>
    </section>
    <section>
      <title>Example using C language</title>
      <para>
	The supplied example (<filename>example_xta_macc01.c</filename>) uses
	Oracle in the role of <quote>Resource Manager 1</quote>; please
	refer to the instructions explained:
	<itemizedlist mark="bullet">
	  <listitem><para>
	    in <xref linkend="App_RM_Config_Oracle_Remote"/> 
	    to set-up the correct client/server configuration for Oracle
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="Starting_the_state_server"/>
	    to start up the LIXA state server
	  </para></listitem>
	</itemizedlist>
      </para>
      <para>
	Create a working directory in a place you are comfortable with:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	Copy file <filename>example_xta_macc01.c</filename> in your working
	dir:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
	    tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/example_xta_macc01.c .
	  </screen></td></tr></tbody>
	</table>
	Substitute <quote>X.Y.Z</quote> with the actual version of
	the software you installed.
      </para>
      <para>
	Compile and link the C example program:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ . /opt/lixa/bin/lixa_env.sh 
tiian@ubuntu1404-64:~/tmp$ gcc example_xta_macc01.c $(lixa-config -x -c -f -l -d) \
> -I/opt/oracle/instantclient_12_1/sdk/include \
> -L/opt/oracle/instantclient_12_1 \
> -Wl,-rpath -Wl,/opt/oracle/instantclient_12_1 \
> -l clntsh -l nnz12 -o example_xta_macc01
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	If the previous steps worked for you, you should have an executable file
	of name <filename>example_xta_sa01</filename> in your current 
	directory:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l
total 36
-rwxrwxr-x 1 tiian tiian 18647 mar 27 21:51 example_xta_macc01
-rw-r--r-- 1 tiian tiian 12828 mar 27 21:50 example_xta_macc01.c
	  </screen></td></tr></tbody>
	</table>
	The example program accepts four arguments:
	<itemizedlist mark="bullet">
          <listitem><para>
	    commit (or rollback): use <quote>1</quote> if you want to perform
	    a global commit or <quote>0</quote> if you want to perform a global
	    rollback
	  </para></listitem>
          <listitem><para>
	    insert (or delete): use <quote>1</quote> if you want to insert rows
	    in databases or <quote>0</quote> if you want to delete rows from
	    databases
	  </para></listitem>
          <listitem><para>
	    superior (or subordinate): use <quote>1</quote> if you want to
	    execute the <quote>superior</quote> part depicted in the
	    sequence diagram (<quote>Application Program 1</quote>) or
	    <quote>0</quote> if you want to execute the
	    <quote>subordinate</quote> part depicted in the sequence diagram
	    (<quote>Application Program 2</quote>)
	  </para></listitem>
          <listitem><para>
	    XIDfilename: a valid name for a file that must be used to transfer
	    XID (Transaction ID) from <quote>Application Program 1</quote> to
	    <quote>Application Program 2</quote>; XIDfilename can be the name
	    of a regular file or of a FIFO (named pipe)
	  </para></listitem>
	</itemizedlist>
      </para>
      <para>
	Open three terminal sessions: one for Application Program 1
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -la
total 44
drwxrwxr-x  2 tiian tiian  4096 mar 27 22:06 .
drwxr-xr-x 12 tiian tiian  4096 mar 27 21:52 ..
-rwxrwxr-x  1 tiian tiian 18647 mar 27 21:51 example_xta_macc01
-rw-r--r--  1 tiian tiian 12828 mar 27 21:50 example_xta_macc01.c
	  </screen></td></tr></tbody>
	</table>
	another one for Application Program 2
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -la
total 44
drwxrwxr-x  2 tiian tiian  4096 mar 27 22:06 .
drwxr-xr-x 12 tiian tiian  4096 mar 27 21:52 ..
-rwxrwxr-x  1 tiian tiian 18647 mar 27 21:51 example_xta_macc01
-rw-r--r--  1 tiian tiian 12828 mar 27 21:50 example_xta_macc01.c
	  </screen></td></tr></tbody>
	</table>
	and the last one for Oracle <command>sqlplus</command> client
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ . ./oracle_env.sh 
tiian@ubuntu1404-64:~$ sqlplus hr/hr@lixa_ora_db

SQL*Plus: Release 12.1.0.2.0 Production on Tue Mar 27 22:08:39 2018

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Tue Mar 27 2018 22:00:12 +02:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt;
	  </screen></td></tr></tbody>
	</table>
	create a FIFO (named pipe) in current directory:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ mkfifo xid.fifo
tiian@ubuntu1404-64:~/tmp$ ls -la
total 44
drwxrwxr-x  2 tiian tiian  4096 mar 27 22:10 .
drwxr-xr-x 12 tiian tiian  4096 mar 27 21:52 ..
-rwxrwxr-x  1 tiian tiian 18647 mar 27 21:51 example_xta_macc01
-rw-r--r--  1 tiian tiian 12828 mar 27 21:50 example_xta_macc01.c
prw-rw-r--  1 tiian tiian     0 mar 27 22:10 xid.fifo
	  </screen></td></tr></tbody>
	</table>
	set <varname>LIXA_PROFILE</varname> environment variable to
	<constant>XTA_DYN</constant> a profile without static 
	Resource Managers defined in
	<filename>lixac_conf.xml</filename>:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	in the first terminal session, start
	<command>example_xta_macc01</command> in the role of AP1 and in the
	second terminal session, start <command>example_xta_macc01</command>
	in the role of AP2
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc01 1 1 1 xid.fifo 
OCI statement &gt;INSERT INTO authors (ID, LAST_NAME, FIRST_NAME) VALUES(1930, 'Bonatti', 'Walter')&lt; completed
XID='1279875137.67f9ed180b7f4fe8a9d0f749a0f9e90b.5ed2d6ffa60ad419517220dd5ab2719e' has been written in file 'xid.fifo'
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc01 1 1 0 xid.fifo 
XID='1279875137.67f9ed180b7f4fe8a9d0f749a0f9e90b.5ed2d6ffa60ad419517220dd5ab2719e' has been read from file 'xid.fifo'
OCI statement &gt;INSERT INTO authors (ID, LAST_NAME, FIRST_NAME) VALUES(1948, 'Casarotto', 'Renato')&lt; completed
	  </screen></td></tr></tbody>
	</table>
	<note><para>
	  Application Program 1 suspends its execution and waits 
	  Application Program 2 start: this is a consequence of the FIFO
	  behavior
	</para></note>
	check Oracle table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead>
	  <tbody><tr><td><screen>
SQL&gt; select * from authors;

ID         LAST_NAME            FIRST_NAME
---------- -------------------- --------------------
1930       Bonatti              Walter
1948       Casarotto            Renato

	  </screen></td></tr></tbody>
	</table>
	use a regular file to perform a <command>SQL DELETE</command> followed
	by a rollback:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc01 0 0 1 xid.fifo
OCI statement &gt;DELETE FROM authors WHERE ID=1930&lt; completed
XID='1279875137.1f31836dab1a4081b488a9b3565faaa4.7b4180ecb8fee8c12cbc13637ab4eabb' has been written in file 'xid.fifo'
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc01 0 0 0 xid.fifo
XID='1279875137.1f31836dab1a4081b488a9b3565faaa4.7b4180ecb8fee8c12cbc13637ab4eabb' has been read from file 'xid.fifo'
OCI statement &gt;DELETE FROM authors WHERE ID=1948&lt; completed
	  </screen></td></tr></tbody>
	</table>
	<note><para>
	  Application Program 1 ends its execution without waiting for
	  Application Program 2 start: this is a consequence of the regular
	  file behavior
	</para></note>
	check Oracle table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead>
	  <tbody><tr><td><screen>
SQL&gt; select * from authors;

ID         LAST_NAME            FIRST_NAME
---------- -------------------- --------------------
1930       Bonatti              Walter
1948       Casarotto            Renato

	  </screen></td></tr></tbody>
	</table>
	as expected, the two rows are still in the table because the XA global
	transaction has been rolled back by Application Program 2; XA functions
	executed by Oracle can be inspected in its trace file:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ tail -n 30 /tmp/xa_NULL03272018.trc 
224024.9416.4016678528.2:
xaorollback: xid=0x4c495841-1f31836dab1a4081b488a9b3565faaa4-7b4180ecb8fee8c12cbc13637ab4eabb, rmid=0, flags=0x0


224024.9416.4016678528.2:
OCITransRollback: Attempting


224024.9416.4016678528.2:
OCITransRollback: Succeeded


224024.9416.4016678528.2:
xaorollback: rtn 0


224024.9416.4016678528.2:
xaoclose: xa_info=, rmid=0, flags=0x0


224024.9416.4016678528.2:
OCIServerDetach: Attempting


224024.9416.4016678528.2:
OCIServerDetach: Succeeded


224024.9416.4016678528.2:
xaoclose: rtn 0
	  </screen></td></tr></tbody>
	</table>
	to complete the exercise, use a regular file to perform a
	<command>SQL DELETE</command> followed by a commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc01 1 0 1 xid.fifo
OCI statement &gt;DELETE FROM authors WHERE ID=1930&lt; completed
XID='1279875137.bfd10e4a5fc541f587727304ae34cccf.7b4180ecb8fee8c12cbc13637ab4eabb' has been written in file 'xid.fifo'
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc01 1 0 0 xid.fifo
XID='1279875137.bfd10e4a5fc541f587727304ae34cccf.7b4180ecb8fee8c12cbc13637ab4eabb' has been read from file 'xid.fifo'
OCI statement &gt;DELETE FROM authors WHERE ID=1948&lt; completed
	  </screen></td></tr></tbody>
	</table>
	check Oracle table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead>
	  <tbody><tr><td><screen>
SQL&gt; select * from authors;

no rows selected

	  </screen></td></tr></tbody>
	</table>
	Finally the table is empty; XA functions
	executed by Oracle can be inspected in its trace file:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ tail -n 50 /tmp/xa_NULL03272018.trc 
225247.14985.1108846208.0:
xaostart: return XA_OK


225247.14985.1108846208.0:
xaoend: xid=0x4c495841-bfd10e4a5fc541f587727304ae34cccf-7b4180ecb8fee8c12cbc13637ab4eabb, rmid=0, flags=0x4000000


225247.14985.1108846208.0:
OCITransDetach: Attempting


225247.14985.1108846208.0:
OCITransDetach: Succeeded


225247.14985.1108846208.0:
xaoend: return 0


225247.14985.1108846208.0:
xaocommit: xid=0x4c495841-bfd10e4a5fc541f587727304ae34cccf-7b4180ecb8fee8c12cbc13637ab4eabb, rmid=0, flags=0x40000000


225247.14985.1108846208.0:
OCITransCommit: Attempting


225247.14985.1108846208.0:
OCITransCommit: Succeeded


225247.14985.1108846208.0:
xaocommit: rtn 0


225247.14985.1108846208.0:
xaoclose: xa_info=, rmid=0, flags=0x0


225247.14985.1108846208.0:
OCIServerDetach: Attempting


225247.14985.1108846208.0:
OCIServerDetach: Succeeded


225247.14985.1108846208.0:
xaoclose: rtn 0
	  </screen></td></tr></tbody>
	</table>
	The trace shows that XTA performed a <quote>one phase commit</quote>
	instead of a <quote>two phase commit</quote> because there's only one
	Resource Manager (hint: function <function>xaoprepare</function> has
	not been called by the Transaction Manager).
      </para>
      <section>
	<title>Source Code</title>
	<para>
	  Source code for program <filename>example_xta_macc01.c</filename> is
	  installed in directory
	  <filename>/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta</filename>
	  and is available on <link xlink:href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/example_xta_macc01.c">GitHub</link>.
	  Source code is fully commented for readability.
	</para>
      </section>
    </section>
    <section>
      <title>Example using C++ language</title>
      <para>
	The supplied example (<filename>example_xta_macc11.cpp</filename>) uses
	Oracle in the role of <quote>Resource Manager 1</quote>; please
	refer to the instructions explained:
	<itemizedlist mark="bullet">
	  <listitem><para>
	    in <xref linkend="App_RM_Config_Oracle_Remote"/> 
	    to set-up the correct client/server configuration for Oracle
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="Starting_the_state_server"/>
	    to start up the LIXA state server
	  </para></listitem>
	</itemizedlist>
      </para>
      <para>
	Create a working directory in a place you are comfortable with:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	Copy file <filename>example_xta_macc11.cpp</filename> in your working
	dir:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
	    tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/example_xta_macc11.cpp .
	  </screen></td></tr></tbody>
	</table>
	Substitute <quote>X.Y.Z</quote> with the actual version of
	the software you installed.
      </para>
      <para>
	Compile and link the C++ example program:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ . /opt/lixa/bin/lixa_env.sh 
tiian@ubuntu1404-64:~/tmp$ g++ example_xta_macc11.cpp \
> $(lixa-config -c -f -l -d --xta --language-cpp) \
> -I/opt/oracle/instantclient_12_1/sdk/include \
> -L/opt/oracle/instantclient_12_1 -Wl,-rpath \
> -Wl,/opt/oracle/instantclient_12_1 -l clntsh -l nnz12 -o example_xta_macc11
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	If the previous steps worked for you, you should have an executable
	file of name <filename>example_xta_macc11</filename> in your current 
	directory:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l
total 40
-rwxrwxr-x 1 tiian tiian 26479 ago 26 11:54 example_xta_macc11
-rw-r--r-- 1 tiian tiian 11440 ago 26 11:43 example_xta_macc11.cpp
	  </screen></td></tr></tbody>
	</table>
	The example program accepts four arguments:
	<itemizedlist mark="bullet">
          <listitem><para>
	    commit (or rollback): use <quote>1</quote> if you want to perform
	    a global commit or <quote>0</quote> if you want to perform a global
	    rollback
	  </para></listitem>
          <listitem><para>
	    insert (or delete): use <quote>1</quote> if you want to insert rows
	    in databases or <quote>0</quote> if you want to delete rows from
	    databases
	  </para></listitem>
          <listitem><para>
	    superior (or subordinate): use <quote>1</quote> if you want to
	    execute the <quote>superior</quote> part depicted in the
	    sequence diagram (<quote>Application Program 1</quote>) or
	    <quote>0</quote> if you want to execute the
	    <quote>subordinate</quote> part depicted in the sequence diagram
	    (<quote>Application Program 2</quote>)
	  </para></listitem>
          <listitem><para>
	    XIDfilename: a valid name for a file that must be used to transfer
	    XID (Transaction ID) from <quote>Application Program 1</quote> to
	    <quote>Application Program 2</quote>; XIDfilename can be the name
	    of a regular file or of a FIFO (named pipe)
	  </para></listitem>
	</itemizedlist>
      </para>
      <para>
	Open three terminal sessions: one for Application Program 1
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -la
total 48
drwxrwxr-x  2 tiian tiian  4096 ago 26 11:55 .
drwxr-xr-x 12 tiian tiian  4096 ago 26 11:43 ..
-rwxrwxr-x  1 tiian tiian 26479 ago 26 11:54 example_xta_macc11
-rw-r--r--  1 tiian tiian 11440 ago 26 11:43 example_xta_macc11.cpp
	  </screen></td></tr></tbody>
	</table>
	another one for Application Program 2
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -la
total 48
drwxrwxr-x  2 tiian tiian  4096 ago 26 11:55 .
drwxr-xr-x 12 tiian tiian  4096 ago 26 11:43 ..
-rwxrwxr-x  1 tiian tiian 26479 ago 26 11:54 example_xta_macc11
-rw-r--r--  1 tiian tiian 11440 ago 26 11:43 example_xta_macc11.cpp
	  </screen></td></tr></tbody>
	</table>
	and the last one for Oracle <command>sqlplus</command> client
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ . ./oracle_env.sh 
tiian@ubuntu1404-64:~$ sqlplus hr/hr@lixa_ora_db

SQL*Plus: Release 12.1.0.2.0 Production on Tue Mar 27 22:08:39 2018

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Sun Aug 26 2018 11:42:15 +02:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt;
	  </screen></td></tr></tbody>
	</table>
	create a FIFO (named pipe) in current directory:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -la
total 48
drwxrwxr-x  2 tiian tiian  4096 ago 26 11:58 .
drwxr-xr-x 12 tiian tiian  4096 ago 26 11:57 ..
-rwxrwxr-x  1 tiian tiian 26479 ago 26 11:54 example_xta_macc11
-rw-r--r--  1 tiian tiian 11440 ago 26 11:43 example_xta_macc11.cpp
prw-rw-r--  1 tiian tiian     0 ago 26 11:58 xid.fifo
	  </screen></td></tr></tbody>
	</table>
	set <varname>LIXA_PROFILE</varname> environment variable to
	<constant>XTA_DYN</constant> a profile without static 
	Resource Managers defined in
	<filename>lixac_conf.xml</filename>:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	in the first terminal session, start
	<command>example_xta_macc11</command> in the role of AP1 and in the
	second terminal session, start <command>example_xta_macc11</command>
	in the role of AP2
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc11 1 1 1 xid.fifo 
OCI statement &gt;INSERT INTO authors (ID, LAST_NAME, FIRST_NAME) VALUES(1930, 'Bonatti', 'Walter')&lt; completed
XID='1279875137.bd729d47f71b408e92c332a64502e068.7b4180ecb8fee8c12cbc13637ab4eabb' has been written to file 'xid.fifo'
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc11 1 1 0 xid.fifo 
XID='1279875137.bd729d47f71b408e92c332a64502e068.7b4180ecb8fee8c12cbc13637ab4eabb' has been read from file 'xid.fifo'
OCI statement &gt;INSERT INTO authors (ID, LAST_NAME, FIRST_NAME) VALUES(1948, 'Casarotto', 'Renato')&lt; completed
	  </screen></td></tr></tbody>
	</table>
	<note><para>
	  Application Program 1 suspends its execution and waits 
	  Application Program 2 start: this is a consequence of the FIFO
	  behavior
	</para></note>
	check Oracle table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead>
	  <tbody><tr><td><screen>
SQL&gt; select * from authors;

ID         LAST_NAME            FIRST_NAME
---------- -------------------- --------------------
1930       Bonatti              Walter
1948       Casarotto            Renato

	  </screen></td></tr></tbody>
	</table>
	use a regular file to perform a <command>SQL DELETE</command> followed
	by a rollback:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc11 0 0 1 xid.fifo
OCI statement &gt;DELETE FROM authors WHERE ID=1930&lt; completed
XID='1279875137.f54399449c1d409c999dc8010e7d6e9f.7b4180ecb8fee8c12cbc13637ab4eabb' has been written to file 'xid.fifo'
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc11 0 0 0 xid.fifo
XID='1279875137.f54399449c1d409c999dc8010e7d6e9f.7b4180ecb8fee8c12cbc13637ab4eabb' has been read from file 'xid.fifo'
OCI statement &gt;DELETE FROM authors WHERE ID=1948&lt; completed
	  </screen></td></tr></tbody>
	</table>
	<note><para>
	  Application Program 1 ends its execution without waiting for
	  Application Program 2 start: this is a consequence of the regular
	  file behavior
	</para></note>
	check Oracle table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead>
	  <tbody><tr><td><screen>
SQL&gt; select * from authors;

ID         LAST_NAME            FIRST_NAME
---------- -------------------- --------------------
1930       Bonatti              Walter
1948       Casarotto            Renato

	  </screen></td></tr></tbody>
	</table>
	as expected, the two rows are still in the table because the XA global
	transaction has been rolled back by Application Program 2; XA functions
	executed by Oracle can be inspected in its trace file:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ tail -n 30 /tmp/xa_NULL08262018.trc 
120438.18832.1685579456.0:
xaorollback: xid=0x4c495841-f54399449c1d409c999dc8010e7d6e9f-7b4180ecb8fee8c12cbc13637ab4eabb, rmid=0, flags=0x0


120438.18832.1685579456.0:
OCITransRollback: Attempting


120438.18832.1685579456.0:
OCITransRollback: Succeeded


120438.18832.1685579456.0:
xaorollback: rtn 0


120438.18832.1685579456.0:
xaoclose: xa_info=, rmid=0, flags=0x0


120438.18832.1685579456.0:
OCIServerDetach: Attempting


120438.18832.1685579456.0:
OCIServerDetach: Succeeded


120438.18832.1685579456.0:
xaoclose: rtn 0
	  </screen></td></tr></tbody>
	</table>
	to complete the exercise, use a regular file to perform a
	<command>SQL DELETE</command> followed by a commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc11 1 0 1 xid.fifo
OCI statement &gt;DELETE FROM authors WHERE ID=1930&lt; completed
XID='1279875137.d1c98d095a64415eb7370fc781af25d9.7b4180ecb8fee8c12cbc13637ab4eabb' has been written to file 'xid.fifo'
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc11 1 0 0 xid.fifo
XID='1279875137.d1c98d095a64415eb7370fc781af25d9.7b4180ecb8fee8c12cbc13637ab4eabb' has been read from file 'xid.fifo'
OCI statement &gt;DELETE FROM authors WHERE ID=1948&lt; completed
	  </screen></td></tr></tbody>
	</table>
	check Oracle table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead>
	  <tbody><tr><td><screen>
SQL&gt; select * from authors;

no rows selected

	  </screen></td></tr></tbody>
	</table>
	Finally the table is empty; XA functions
	executed by Oracle can be inspected in its trace file:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ tail -n 50 /tmp/xa_NULL08262018.trc 
120832.23393.3240638144.0:
xaoclose: rtn 0


120832.23394.1448613568.0:
xaoend: xid=0x4c495841-d1c98d095a64415eb7370fc781af25d9-7b4180ecb8fee8c12cbc13637ab4eabb, rmid=0, flags=0x4000000


120832.23394.1448613568.0:
OCITransDetach: Attempting


120832.23394.1448613568.0:
OCITransDetach: Succeeded


120832.23394.1448613568.0:
xaoend: return 0


120832.23394.1448613568.0:
xaocommit: xid=0x4c495841-d1c98d095a64415eb7370fc781af25d9-7b4180ecb8fee8c12cbc13637ab4eabb, rmid=0, flags=0x40000000


120832.23394.1448613568.0:
OCITransCommit: Attempting


120832.23394.1448613568.0:
OCITransCommit: Succeeded


120832.23394.1448613568.0:
xaocommit: rtn 0


120832.23394.1448613568.0:
xaoclose: xa_info=, rmid=0, flags=0x0


120832.23394.1448613568.0:
OCIServerDetach: Attempting


120832.23394.1448613568.0:
OCIServerDetach: Succeeded


120832.23394.1448613568.0:
xaoclose: rtn 0
	  </screen></td></tr></tbody>
	</table>
	The trace shows that XTA performed a <quote>one phase commit</quote>
	instead of a <quote>two phase commit</quote> because there's only one
	Resource Manager (hint: function <function>xaoprepare</function> has
	not been called by the Transaction Manager).
      </para>
      <section>
	<title>Source Code</title>
	<para>
	  Source code for program <filename>example_xta_macc11.cpp</filename>
	  is installed in directory
	  <filename>/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/cpp</filename>
	  and is available on <link xlink:href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/cpp/example_xta_macc11.cpp">GitHub</link>.
	  Source code is fully commented for readability.
	</para>
      </section>
    </section>

  </section>
  <section xml:id="xta_macbps">
    <title>The
    <quote>Multiple Applications, Concurrent Branches/Pseudo Synchronous</quote>
    Pattern</title>
    <table frame="box">
      <thead>
	<tr><td>The pattern in brief:</td></tr>
      </thead>
      <tbody>
	<tr>
	  <td>Architecture:</td>
	  <td>see <xref linkend="xta_arch03"/></td>
	</tr>
	<tr>
	  <td>Number of Application Programs:</td>
	  <td>2 or more</td>
	</tr>
	<tr>
	  <td>Number of Resource Managers:</td>
	  <td>1 or more for every Application Program</td>
	</tr>
	<tr>
	  <td>Number of Branches in the Gloabal Transaction:</td>
	  <td>1 for every Application Program</td>
	</tr>
	<tr>
	  <td>Concurrency among Application Programs:</td>
	  <td>yes, subordinate AP prepares the transaction, returns control to superior AP and finally completes commit</td>
	</tr>
      </tbody>
    </table>
    <section>
      <title>Description</title>
      <para>
	This is a Distributed Transaction Processing pattern introduced by
	XTA: two or more Application Programs use any set of Resource
	Manager(s) and perform concurrent operations inside distinct branches
	of a common XA global transaction. The Resource Manager(s) must 
	support concurrent branches of the same global transaction: this is
	part of XA standard, but some resource managers might not support it.
      </para>
      <para>
	The following picture shows an example that can be implemented, for
	example, using MySQL (or MariaDB) and PostgreSQL.
	<figure xml:id="xta_pattern08">
	  <title>Example of <quote>Multiple Applications, 
	  Consecutive Calls/Pseudo Synchronous</quote> with two Application
	  Programs and two Resource Managers</title>
	  <mediaobject>
	    <imageobject>
	      <imagedata fileref="../images/LIXA_Development_XTA_08.svg"/>
	    </imageobject>
	  </mediaobject>
	</figure>
	The pattern can <emphasis>not</emphasis> be implemented using the
	standard TX Transaction	Demarcation interface.
      </para>
    </section>
    <section>
      <title>How it works</title>
      <figure xml:id="xta_pattern09">
	<title>Simplified sequence diagram for the
	<quote>Multiple Applications, Concurrent Branches/Pseudo Synchronous</quote>
	Pattern</title>
	<mediaobject>
	  <imageobject>
	    <imagedata fileref="../images/LIXA_Development_XTA_09.svg"/>
	  </imageobject>
	</mediaobject>
      </figure>
      <para>
	The above figure shows the logic necessary to build this type of
	applications; it's <emphasis>not</emphasis> a formally correct UML
	sequence diagram (all the XTA objects are in the same lifeline), but
	it should be clear enough to understand the
	proper operations sequence:
      </para>
      <itemizedlist mark='bullet'>
	<listitem><para>
	  Both the Application Programs perform some some initial steps like:
	  opening a native connection to the Resource Manager, creating a 
	  Transaction Manager object, a XA Resource Manager object, a
	  Transaction object and finally enlisting and opening the Resource
	  Manager
	</para></listitem>
	<listitem><para>
	  The first AP, named <quote>superior</quote> using XA terminology,
	  <emphasis>starts</emphasis> the global transaction and possibly
	  updates the state of its Resource Manager
	</para></listitem>
	<listitem><para>
	  The first AP retrieves the XID associated to the global transaction
	  and starts some sort of <quote>remote procedure call</quote>
	  <footnote><para>
	    This must not be confused with a specific RPC technology: any
	    communication technique that supports a request-response protocol
	    can be used.
	  </para></footnote>
	  to invoke the second AP; it must pass the XID and all the application
	  context necessary to operate (this is not relevant to XTA)
	</para></listitem>
	<listitem><para>
	  The second AP, named <quote>subordinate</quote> using XA terminology,
	  <emphasis>branches</emphasis> the global transaction and
	  possibly updates the state of its Resource Manager
	</para></listitem>
	<listitem><para>
	  The second AP <emphasis>starts</emphasis> the first phase of the
	  distributed <emphasis>commit</emphasis> specifying 
	  <quote>non_block=TRUE</quote> option: this translates in performing
	  <quote>XA prepare</quote> without performing <quote>XA commit</quote>
	</para></listitem>
	<listitem><para>
	  At the end of the first phase of the distributed commit, the second
	  AP responds to first AP: typically a return code related to commit
	  operation
	</para></listitem>
	<listitem><para>
	  Since then now, both the APs can run concurrently to complete the
	  distributed <emphasis>commit</emphasis> specifying 
	  <quote>non_block=FALSE</quote> option (in the provided example,
	  the first AP performs another update to its Resource Manager before
	  committing)
	</para></listitem>
	<listitem><para>
	  The last operations are related to clean-up
	</para></listitem>
      </itemizedlist>
      <note><para>
	The dashed red rectangle highlights the XA global transaction.
      </para></note>
      <important><para>
	These are the relevant elements of this pattern:
	<itemizedlist mark='bullet'>
	  <listitem><para>
	    it's designed for a typical client/server approach with some sort
	    of request-response communication protocol in place
	  </para></listitem>
	  <listitem><para>
	    the Application Programs run concurrently, but synchronize 
	    themselves by mean of the communication protocol and the LIXA
	    state server: the second phase of the two phase commit protocol
	    can be started only after the completion of the first phase by all
	    the participants
	  </para></listitem>
	  <listitem><para>
	    the second Application Program can <emphasis>not</emphasis> 
	    terminate immediately after returning the response to the caller:
	    it must perform the second phase of the two phase commit protocol
	  </para></listitem>
	  <listitem><para>
	    the first Application Program can perform Resource Manager related
	    operations <emphasis>before and after</emphasis> the call to the
	    second Application Program
	  </para></listitem>
	  <listitem><para>
	    the diagram shows an example with two Application Programs, but
	    the pattern can be applied to any number of Application 
	    Programs: a subordinate AP can become a superior AP of a called
	    subordinate AP and so on
	  </para></listitem>
	  <listitem><para>
	    the diagram shows an example with only one Resource Manager for
	    every Application Program, but there's no restriction on
	    LIXA and XTA side, on the number of Resource Managers used by an
	    Application Program
	  </para></listitem>
	</itemizedlist>
      </para></important>
    </section>
    <section>
      <title>Example using C language</title>
      <para>
	The supplied examples (<filename>example_xta_macbps01.c</filename> and
	<filename>example_xta_macbps02.c</filename>) use
	PostgreSQL in the role of <quote>Resource Manager 2</quote> and MySQL
	(or MariaDB) in the role of <quote>Resource Manager 1</quote>; please
	refer to the instructions explained:
	<itemizedlist mark="bullet">
	  <listitem><para>
	    in <xref linkend="App_RM_Config_MySQL"/>
	    to set-up a running environment for MySQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="App_RM_Config_PostgreSQL"/>
	    to set-up a running environment for PostgreSQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="Starting_the_state_server"/>
	    to start up the LIXA state server.
	  </para></listitem>
	</itemizedlist>
	Both programs must be used to execute the example: 
	<filename>example_xta_macbps01</filename> in the role of the superior
	Application Program (first AP) and
	<filename>example_xta_macbps02</filename> in the role of the
	subordinate Application Program (second AP).
      </para>
      <para>
	Create a working directory in a place you are comfortable with:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	Copy files <filename>example_xta_macbps01.c</filename> and 
	<filename>example_xta_macbps02.c</filename> in your working dir:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/example_xta_macbps01.c .
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/example_xta_macbps02.c .
	  </screen></td></tr></tbody>
	</table>
	Substitute <quote>X.Y.Z</quote> with the actual version of
	the software you installed.
      </para>
      <para>
	Compile and link the C example programs:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ . /opt/lixa/bin/lixa_env.sh
tiian@ubuntu1404-64:~/tmp$ gcc example_xta_macbps01.c $(lixa-config -x -c -f -l -d) $(mysql_config --libs_r) -o example_xta_macbps01
tiian@ubuntu1404-64:~/tmp$ gcc example_xta_macbps02.c $(lixa-config -x -c -f -l -d) -lpq -o example_xta_macbps02
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	If the previous steps worked for you, you should have two executable
	files of name <filename>example_xta_macbps01</filename> and
	<filename>example_xta_macbps02</filename> in your current directory:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l
total 96
-rwxrwxr-x 1 tiian tiian 18499 apr  8 22:08 example_xta_macbps01
-rw-r--r-- 1 tiian tiian 10459 apr  8 11:58 example_xta_macbps01.c
-rwxrwxr-x 1 tiian tiian 18319 apr  8 22:08 example_xta_macbps02
-rw-r--r-- 1 tiian tiian 11095 apr  8 11:58 example_xta_macbps02.c
	  </screen></td></tr></tbody>
	</table>
	The example programs accept four arguments:
	<itemizedlist mark="bullet">
          <listitem><para>
	    commit (or rollback): use <quote>1</quote> if you want to perform
	    a global commit or <quote>0</quote> if you want to perform a global
	    rollback
	  </para></listitem>
          <listitem><para>
	    insert (or delete): use <quote>1</quote> if you want to insert rows
	    in databases or <quote>0</quote> if you want to delete rows from
	    databases
	  </para></listitem>
          <listitem><para>
	    name of the FIFO (named pipe) that will be used to send messages
	    from the superior AP to the subordinate AP
	  </para></listitem>
          <listitem><para>
	    name of the FIFO (named pipe) that will be used to return messages
	    from the subordinate AP to the superior AP
	  </para></listitem>
	</itemizedlist>
      </para>
      <para>
	Open four terminal sessions: two for the example programs execution,
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbps01
-rwxrwxr-x 1 tiian tiian 18499 apr  8 22:08 example_xta_macbps01
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbps02
-rwxrwxr-x 1 tiian tiian 18319 apr  8 22:08 example_xta_macbps02
	  </screen></td></tr></tbody>
	</table>
	one for MySQL queries,
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 36
Server version: 5.5.59-0ubuntu0.14.04.1 (Ubuntu)

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql>
	  </screen></td></tr></tbody>
	</table>
	and one for PostgreSQL queries
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ psql testdb
psql (9.3.22)
Type "help" for help.

testdb=>
	  </screen></td></tr></tbody>
	</table>
	Set <varname>LIXA_PROFILE</varname> environment variable to
	<constant>XTA_DYN</constant>,
	a profile without static Resource Managers defined in
	<filename>lixac_conf.xml</filename>:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	create two named pipes (FIFO) to support communication between
	superior and subordinate Application Programs
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ mkfifo sup2sub
tiian@ubuntu1404-64:~/tmp$ mkfifo sub2sup
tiian@ubuntu1404-64:~/tmp$ ls -l su*
prw-rw-r-- 1 tiian tiian 0 apr  8 22:22 sub2sup
prw-rw-r-- 1 tiian tiian 0 apr  8 22:22 sup2sub
	  </screen></td></tr></tbody>
	</table>
	execute both the example programs to insert rows in tables and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps01 1 1 sup2sub sub2sup
MySQL, executing &gt;INSERT INTO authors VALUES(1919, 'Levi', 'Primo')&lt;
Superior AP has sent XID '1279875137.b6df6743cbf54cb8b8323ca5ab771e6e.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'PREPARED_for_COMMIT' reply from subordinate AP
MySQL, executing &gt;INSERT INTO authors VALUES(1898, 'Remarque', 'Erich Maria')&lt;
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps02 1 1 sup2sub sub2sup
Subordinate AP has received XID '1279875137.b6df6743cbf54cb8b8323ca5ab771e6e.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.b6df6743cbf54cb8b8323ca5ab771e6e.e107cfeee0661d23af7f136da1b84c3b'
PostgreSQL, executing &gt;INSERT INTO authors VALUES(1921, 'Rigoni Stern', 'Mario')&lt;
Subordinate AP has returned 'PREPARED_for_COMMIT' to superior AP
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	<note>
	  <para>
	    The first (superior) Application Program suspends and waits the
	    return value from the second (subordinate) Application Program.
	  </para>
	  <para>
	    The XID generated by the subordinate AP differs from the XID
	    generated by the superior AP in the last 16 hexadecimal symbols
	    of the <quote>branch qualifier</quote>; the first 16 hexadecimal
	    symbols are the same: this is not required by XA specification but
	    can be useful for troubleshooting purposes.
	  </para>
	</note>
	Check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1898 | Remarque  | Erich Maria |
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
2 rows in set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	delete rows from tables, but rollback:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps01 0 0 sup2sub sub2sup 
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has sent XID '1279875137.1911a9c72cec45eea47ffc74cf95e000.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'ROLLBACK' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1898&lt;
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps02 0 0 sup2sub sub2sup
Subordinate AP has received XID '1279875137.1911a9c72cec45eea47ffc74cf95e000.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.1911a9c72cec45eea47ffc74cf95e000.e107cfeee0661d233a125b14214944da'
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has returned 'ROLLBACK' to superior AP
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1898 | Remarque  | Erich Maria |
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
2 rows in set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	delete rows and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps01 1 0 sup2sub sub2sup 
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has sent XID '1279875137.c862b6aa72784c808e6c59388e4263a9.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'PREPARED_for_COMMIT' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1898&lt;
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps02 1 0 sup2sub sub2sup
Subordinate AP has received XID '1279875137.c862b6aa72784c808e6c59388e4263a9.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.c862b6aa72784c808e6c59388e4263a9.e107cfeee0661d234acf9ddb30da46f9'
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has returned 'PREPARED_for_COMMIT' to superior AP
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
Empty set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
(0 rows)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
      </para>
      <section>
	<title>Source Code</title>
	<para>
	  Source code for programs <filename>example_xta_macbps01.c</filename> 
	  and <filename>example_xta_macbps02.c</filename> are
	  installed in directory
	  <filename>/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta</filename> and
	  are available on <link xlink:href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/">GitHub</link>. Source code is fully
	  commented for readability.
	</para>
      </section>
    </section>
    <section>
      <title>Example using C++ language</title>
      <para>
	The supplied examples (<filename>example_xta_macbps11.cpp</filename>
	and <filename>example_xta_macbps12.cpp</filename>) use
	PostgreSQL in the role of <quote>Resource Manager 2</quote> and MySQL
	(or MariaDB) in the role of <quote>Resource Manager 1</quote>; please
	refer to the instructions explained:
	<itemizedlist mark="bullet">
	  <listitem><para>
	    in <xref linkend="App_RM_Config_MySQL"/>
	    to set-up a running environment for MySQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="App_RM_Config_PostgreSQL"/>
	    to set-up a running environment for PostgreSQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="Starting_the_state_server"/>
	    to start up the LIXA state server.
	  </para></listitem>
	</itemizedlist>
	Both programs must be used to execute the example: 
	<filename>example_xta_macbps11</filename> in the role of the superior
	Application Program (first AP) and
	<filename>example_xta_macbps12</filename> in the role of the
	subordinate Application Program (second AP).
      </para>
      <para>
	Create a working directory in a place you are comfortable with:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	Copy files <filename>example_xta_macbps11.cpp</filename> and 
	<filename>example_xta_macbps12.cpp</filename> in your working dir:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/cpp/example_xta_macbps11.cpp .
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/cpp/example_xta_macbps12.cpp .
	  </screen></td></tr></tbody>
	</table>
	Substitute <quote>X.Y.Z</quote> with the actual version of
	the software you installed.
      </para>
      <para>
	Compile and link the C++ example programs:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ . /opt/lixa/bin/lixa_env.sh
tiian@ubuntu1404-64:~/tmp$ g++ example_xta_macbps11.cpp $(lixa-config -c -f -l -d --xta --language-cpp) $(mysql_config --libs_r) -o example_xta_macbps11
tiian@ubuntu1404-64:~/tmp$ g++ example_xta_macbps12.cpp $(lixa-config -c -f -l -d --xta --language-cpp) -lpq -o example_xta_macbps12
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	If the previous steps worked for you, you should have two executable
	files of name <filename>example_xta_macbps11</filename> and
	<filename>example_xta_macbps12</filename> in your current directory:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l
total 80
-rwxrwxr-x 1 tiian tiian 26419 ago 26 21:56 example_xta_macbps11
-rw-r--r-- 1 tiian tiian  8779 ago 26 21:54 example_xta_macbps11.cpp
-rwxrwxr-x 1 tiian tiian 26399 ago 26 21:56 example_xta_macbps12
-rw-r--r-- 1 tiian tiian 10028 ago 26 21:54 example_xta_macbps12.cpp
	  </screen></td></tr></tbody>
	</table>
	The example programs accept four arguments:
	<itemizedlist mark="bullet">
          <listitem><para>
	    commit (or rollback): use <quote>1</quote> if you want to perform
	    a global commit or <quote>0</quote> if you want to perform a global
	    rollback
	  </para></listitem>
          <listitem><para>
	    insert (or delete): use <quote>1</quote> if you want to insert rows
	    in databases or <quote>0</quote> if you want to delete rows from
	    databases
	  </para></listitem>
          <listitem><para>
	    name of the FIFO (named pipe) that will be used to send messages
	    from the superior AP to the subordinate AP
	  </para></listitem>
          <listitem><para>
	    name of the FIFO (named pipe) that will be used to return messages
	    from the subordinate AP to the superior AP
	  </para></listitem>
	</itemizedlist>
      </para>
      <para>
	Open four terminal sessions: two for the example programs execution,
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbps11
-rwxrwxr-x 1 tiian tiian 18499 apr  8 22:08 example_xta_macbps11
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbps12
-rwxrwxr-x 1 tiian tiian 18319 apr  8 22:08 example_xta_macbps12
	  </screen></td></tr></tbody>
	</table>
	one for MySQL queries,
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 36
Server version: 5.5.61-0ubuntu0.14.04.1 (Ubuntu)

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> 
	  </screen></td></tr></tbody>
	</table>
	and one for PostgreSQL queries
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ psql testdb
psql (9.3.24)
Type "help" for help.

testdb=>
	  </screen></td></tr></tbody>
	</table>
	Set <varname>LIXA_PROFILE</varname> environment variable to
	<constant>XTA_DYN</constant>,
	a profile without static Resource Managers defined in
	<filename>lixac_conf.xml</filename>:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	create two named pipes (FIFO) to support communication between
	superior and subordinate Application Programs
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ mkfifo sup2sub
tiian@ubuntu1404-64:~/tmp$ mkfifo sub2sup
tiian@ubuntu1404-64:~/tmp$ ls -l su*
prw-rw-r-- 1 tiian tiian 0 ago 26 22:01 sub2sup
prw-rw-r-- 1 tiian tiian 0 ago 26 22:01 sup2sub
	  </screen></td></tr></tbody>
	</table>
	execute both the example programs to insert rows in tables and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps11 1 1 sup2sub sub2sup
MySQL, executing &gt;INSERT INTO authors VALUES(1919, 'Levi', 'Primo')&lt;
Superior AP has sent XID '1279875137.a65b66b6b0874a948f8f09b7a23dd471.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'PREPARED_for_COMMIT' reply from subordinate AP
MySQL, executing &gt;INSERT INTO authors VALUES(1898, 'Remarque', 'Erich Maria')&lt;
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps12 1 1 sup2sub sub2sup
Subordinate AP has received XID '1279875137.a65b66b6b0874a948f8f09b7a23dd471.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.a65b66b6b0874a948f8f09b7a23dd471.e107cfeee0661d235888e12f34d54013'
PostgreSQL, executing &gt;INSERT INTO authors VALUES(1921, 'Rigoni Stern', 'Mario')&lt;
Subordinate AP has returned 'PREPARED_for_COMMIT' to superior AP
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	<note>
	  <para>
	    The first (superior) Application Program suspends and waits the
	    return value from the second (subordinate) Application Program.
	  </para>
	  <para>
	    The XID generated by the subordinate AP differs from the XID
	    generated by the superior AP in the last 16 hexadecimal symbols
	    of the <quote>branch qualifier</quote>; the first 16 hexadecimal
	    symbols are the same: this is not required by XA specification but
	    can be useful for troubleshooting purposes.
	  </para>
	</note>
	Check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1898 | Remarque  | Erich Maria |
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
2 rows in set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	delete rows from tables, but rollback:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps11 0 0 sup2sub sub2sup
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has sent XID '1279875137.b154aa98393d44098c8a20ed2ba488cf.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'ROLLBACK' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1898&lt;
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps12 0 0 sup2sub sub2sup
Subordinate AP has received XID '1279875137.b154aa98393d44098c8a20ed2ba488cf.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.b154aa98393d44098c8a20ed2ba488cf.e107cfeee0661d237add9066cfc34a81'
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has returned 'ROLLBACK' to superior AP
tiian@ubuntu1404-64:~/tmp$ 
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1898 | Remarque  | Erich Maria |
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
2 rows in set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	delete rows and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps11 1 0 sup2sub sub2sup
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has sent XID '1279875137.06db3e25e74a4a03bdf7ef4924409255.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'PREPARED_for_COMMIT' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1898&lt;
tiian@ubuntu1404-64:~/tmp$ 
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps12 1 0 sup2sub sub2sup
Subordinate AP has received XID '1279875137.06db3e25e74a4a03bdf7ef4924409255.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.06db3e25e74a4a03bdf7ef4924409255.e107cfeee0661d23cc258059f852467e'
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has returned 'PREPARED_for_COMMIT' to superior AP
tiian@ubuntu1404-64:~/tmp$ 
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
Empty set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
(0 rows)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
      </para>
      <section>
	<title>Source Code</title>
	<para>
	  Source code for programs <filename>example_xta_macbps11.cpp</filename> 
	  and <filename>example_xta_macbps12.cpp</filename> are
	  installed in directory
	  <filename>/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/cpp</filename> and
	  are available on <link xlink:href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/cpp">GitHub</link>. Source code is fully
	  commented for readability.
	</para>
      </section>
    </section>
    <section>
      <title>Example using Python language</title>
      <para>
	The supplied examples (<filename>example_xta_macbps21.py</filename>
	and <filename>example_xta_macbps22.py</filename>) use
	PostgreSQL in the role of <quote>Resource Manager 2</quote> and MySQL
	(or MariaDB) in the role of <quote>Resource Manager 1</quote>; please
	refer to the instructions explained:
	<itemizedlist mark="bullet">
	  <listitem><para>
	    in <xref linkend="XTA_Technology_Matrix"/>
	    to build and install the Python database drivers that can be used
	    with XTA
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="App_RM_Config_MySQL"/>
	    to set-up a running environment for MySQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="App_RM_Config_PostgreSQL"/>
	    to set-up a running environment for PostgreSQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="Starting_the_state_server"/>
	    to start up the LIXA state server.
	  </para></listitem>
	</itemizedlist>
	Both programs must be used to execute the example: 
	<filename>example_xta_macbps21.py</filename> in the role of the
	superior Application Program (first AP) and
	<filename>example_xta_macbps22.py</filename> in the role of the
	subordinate Application Program (second AP).
	Python 2 and Python 3 can be used even mixing them: one for the first
	AP and one for the second AP.
      </para>
      <para>
	Create a working directory in a place you are comfortable with:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	Copy files <filename>example_xta_macbps21.py</filename> and 
	<filename>example_xta_macbps22.py</filename> in your working dir:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/python/example_xta_macbps21.py .
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/python/example_xta_macbps22.py .
	  </screen></td></tr></tbody>
	</table>
	Substitute <quote>X.Y.Z</quote> with the actual version of
	the software you installed.
      </para>
      <para>
	The example programs accept four arguments:
	<itemizedlist mark="bullet">
          <listitem><para>
	    commit (or rollback): use <quote>1</quote> if you want to perform
	    a global commit or <quote>0</quote> if you want to perform a global
	    rollback
	  </para></listitem>
          <listitem><para>
	    insert (or delete): use <quote>1</quote> if you want to insert rows
	    in databases or <quote>0</quote> if you want to delete rows from
	    databases
	  </para></listitem>
          <listitem><para>
	    name of the FIFO (named pipe) that will be used to send messages
	    from the superior AP to the subordinate AP
	  </para></listitem>
          <listitem><para>
	    name of the FIFO (named pipe) that will be used to return messages
	    from the subordinate AP to the superior AP
	  </para></listitem>
	</itemizedlist>
      </para>
      <para>
	Open four terminal sessions: two for the example programs execution,
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbps21.py 
-rw-r--r-- 1 tiian tiian 4701 ott 15 22:28 example_xta_macbps21.py
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbps22.py 
-rw-r--r-- 1 tiian tiian 5266 ott 15 22:28 example_xta_macbps22.py
	  </screen></td></tr></tbody>
	</table>
	one for MySQL queries,
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 36
Server version: 5.5.61-0ubuntu0.14.04.1 (Ubuntu)

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> 
	  </screen></td></tr></tbody>
	</table>
	and one for PostgreSQL queries
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ psql testdb
psql (9.3.24)
Type "help" for help.

testdb=>
	  </screen></td></tr></tbody>
	</table>
	Set <varname>LIXA_PROFILE</varname> environment variable to
	<constant>XTA_DYN</constant>,
	a profile without static Resource Managers defined in
	<filename>lixac_conf.xml</filename>:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	create two named pipes (FIFO) to support communication between
	superior and subordinate Application Programs
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ mkfifo sup2sub
tiian@ubuntu1404-64:~/tmp$ mkfifo sub2sup
tiian@ubuntu1404-64:~/tmp$ ls -l su*
prw-rw-r-- 1 tiian tiian 0 ott 15 22:35 sub2sup
prw-rw-r-- 1 tiian tiian 0 ott 15 22:35 sup2sub
	  </screen></td></tr></tbody>
	</table>
	execute both the example programs to insert rows in tables and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbps21.py 1 1 sup2sub sub2sup
MySQL, executing &gt;INSERT INTO authors VALUES(1919, 'Levi', 'Primo')&lt;
Superior AP has sent XID '1279875137.9d22af42e46f4111b23ba3630479c6b9.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'PREPARED_for_COMMIT' reply from subordinate AP
MySQL, executing &gt;INSERT INTO authors VALUES(1898, 'Remarque', 'Erich Maria')&lt;
Superior AP has committed its branch
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbps22.py 1 1 sup2sub sub2sup 
Subordinate AP has received XID '1279875137.9d22af42e46f4111b23ba3630479c6b9.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.9d22af42e46f4111b23ba3630479c6b9.e107cfeee0661d23feeb9fdbaca14974'
PostgreSQL, executing &gt;INSERT INTO authors VALUES(1921, 'Rigoni Stern', 'Mario')&lt;
Subordinate AP has returned 'PREPARED_for_COMMIT' to superior AP
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	<note>
	  <para>
	    The first (superior) Application Program suspends and waits the
	    return value from the second (subordinate) Application Program.
	  </para>
	  <para>
	    The XID generated by the subordinate AP differs from the XID
	    generated by the superior AP in the last 16 hexadecimal symbols
	    of the <quote>branch qualifier</quote>; the first 16 hexadecimal
	    symbols are the same: this is not required by XA specification but
	    can be useful for troubleshooting purposes.
	  </para>
	</note>
	Check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1898 | Remarque  | Erich Maria |
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
2 rows in set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	delete rows from tables, but rollback:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbps21.py 0 0 sup2sub sub2sup 
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has sent XID '1279875137.84ab3fdb762742a096a8181043938232.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'ROLLBACK' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1898&lt;
Superior AP has rolled back its branch
tiian@ubuntu1404-64:~/tmp$
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbps22.py 0 0 sup2sub sub2sup 
Subordinate AP has received XID '1279875137.84ab3fdb762742a096a8181043938232.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.84ab3fdb762742a096a8181043938232.e107cfeee0661d2397f7336b2f6449f2'
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has returned 'ROLLBACK' to superior AP
tiian@ubuntu1404-64:~/tmp$ 
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1898 | Remarque  | Erich Maria |
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
2 rows in set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	delete rows and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbps21.py 1 0 sup2sub sub2sup 
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has sent XID '1279875137.284ca606ec594b94a98a26a0e2e6730a.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'PREPARED_for_COMMIT' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1898&lt;
Superior AP has committed its branch
tiian@ubuntu1404-64:~/tmp$ 
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbps22.py 1 0 sup2sub sub2sup 
Subordinate AP has received XID '1279875137.284ca606ec594b94a98a26a0e2e6730a.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.284ca606ec594b94a98a26a0e2e6730a.e107cfeee0661d23759dd6e4f8ad4afc'
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has returned 'PREPARED_for_COMMIT' to superior AP
tiian@ubuntu1404-64:~/tmp$ 
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
Empty set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
(0 rows)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
      </para>
      <section>
	<title>Source Code</title>
	<para>
	  Source code for programs <filename>example_xta_macbps21.py</filename> 
	  and <filename>example_xta_macbps22.py</filename> are
	  installed in directory
	  <filename>/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/python</filename> and
	  are available on <link xlink:href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/python">GitHub</link>. Source code is fully
	  commented for readability.
	</para>
      </section>
    </section>
  </section>
  <section>
    <title>The
    <quote>Multiple Applications, Concurrent Branches/Pseudo Asynchronous</quote>
    Pattern</title>
    <table frame="box">
      <thead>
	<tr><td>The pattern in brief:</td></tr>
      </thead>
      <tbody>
	<tr>
	  <td>Architecture:</td>
	  <td>see <xref linkend="xta_arch03"/></td>
	</tr>
	<tr>
	  <td>Number of Application Programs:</td>
	  <td>2 or more</td>
	</tr>
	<tr>
	  <td>Number of Resource Managers:</td>
	  <td>1 or more for every Application Program</td>
	</tr>
	<tr>
	  <td>Number of Branches in the Gloabal Transaction:</td>
	  <td>1 for every Application Program</td>
	</tr>
	<tr>
	  <td>Concurrency among Application Programs:</td>
	  <td>yes, subordinate AP creates a new branch and then executes asynchronously</td>
	</tr>
      </tbody>
    </table>
    <section>
      <title>Description</title>
      <para>
	This is a Distributed Transaction Processing pattern introduced by
	XTA: two or more Application Programs use any set of Resource
	Manager(s) and perform concurrent operations inside distinct branches
	of a common XA global transaction. The Resource Manager(s) must 
	support concurrent branches of the same global transaction: this is
	part of XA standard, but some resource managers might not support it.
      </para>
      <para>
	The following picture shows an example that can be implemented, for
	example, using MySQL (or MariaDB) and PostgreSQL.
	<footnote>
	  <para>
	    You may notice that this pattern uses the same architecture shown
	    in <xref linkend="xta_pattern08"/> because it differs from the
	    other pattern only in the order of XTA calls.
	  </para>
	</footnote>
	<figure xml:id="xta_pattern08b">
	  <title>Example of <quote>Multiple Applications, 
	  Consecutive Calls/Pseudo Synchronous</quote> with two Application
	  Programs and two Resource Managers</title>
	  <mediaobject>
	    <imageobject>
	      <imagedata fileref="../images/LIXA_Development_XTA_08.svg"/>
	    </imageobject>
	  </mediaobject>
	</figure>
	The pattern can <emphasis>not</emphasis> be implemented using the
	standard TX Transaction	Demarcation interface.
      </para>
    </section>
    <section>
      <title>How it works</title>
      <figure xml:id="xta_pattern10">
	<title>Simplified sequence diagram for the
	<quote>Multiple Applications, Concurrent Branches/Pseudo Asynchronous</quote>
	Pattern</title>
	<mediaobject>
	  <imageobject>
	    <imagedata fileref="../images/LIXA_Development_XTA_10.svg"/>
	  </imageobject>
	</mediaobject>
      </figure>
      <para>
	The above figure shows the logic necessary to build this type of
	applications; it's <emphasis>not</emphasis> a formally correct UML
	sequence diagram (all the XTA objects are in the same lifeline), but
	it should be clear enough to understand the
	proper operations sequence:
      </para>
      <itemizedlist mark='bullet'>
	<listitem><para>
	  Both the Application Programs perform some some initial steps like:
	  opening a native connection to the Resource Manager, creating a 
	  Transaction Manager object, a XA Resource Manager object, a
	  Transaction object and finally enlisting and opening the Resource
	  Manager
	</para></listitem>
	<listitem><para>
	  The first AP, named <quote>superior</quote> using XA terminology,
	  <emphasis>starts</emphasis> the global transaction
	</para></listitem>
	<listitem><para>
	  The first AP retrieves the XID associated to the global transaction
	  and uses some sort of <quote>message passing</quote>
	  to send the XID to the second AP
	</para></listitem>
	<listitem><para>
	  The second AP, named <quote>subordinate</quote> using XA terminology,
	  <emphasis>branches</emphasis> the global transaction and send back
	  an acknowledge message to the first AP: this is helpful because
	  the superior AP <emphasis>must not</emphasis> start its commit
	  before subordinate branch creation
	</para></listitem>
	<listitem><para>
	  Since then now, the Application Programs can proceed asynchronously
	  with the subsequent operations, specifically using the Resource
	  Managers and committing the distinct branches
	</para></listitem>
	<listitem><para>
	  The last operations are related to clean-up
	</para></listitem>
      </itemizedlist>
      <note><para>
	The dashed red rectangle highlights the XA global transaction.
      </para></note>
      <important><para>
	These are the relevant elements of this pattern:
	<itemizedlist mark='bullet'>
	  <listitem><para>
	    it's designed for a peer to peer approach with some sort
	    of message passing communication protocol in place; it's not
	    strictly asynchronous because there are a couple of synchronization
	    points
	  </para></listitem>
	  <listitem><para>
	    the first synchronization point is represented by the XID sent from
	    the superior AP to the subordinate AP; the acknowledge message is
	    not strictly necessary, but the first AP must not call
	    <function>tx.Commit()</function> before the second AP completed
	    <function>tx.Branch(xid)</function>;
	    conversely, second AP gets a warning because the branch can't be
	    created
	  </para></listitem>
	  <listitem><para>
	    the second synchronization point is implicit in 
	    <function>tx.Commit()</function>: it's a blocking call and all the
	    branches are silently synchronized by the LIXA state server
	  </para></listitem>
	  <listitem><para>
	    even if there are two synchronization points, the Application
	    Programs can really operate concurrently on their Resource
	    Managers and this aspect can allow faster transactions in
	    comparison with the pattern described in
	    <xref linkend="xta_macbps"/>
	  </para></listitem>
	  <listitem><para>
	    the diagram shows an example with two Application Programs, but
	    the pattern can be applied to any number of Application 
	    Programs in different ways: a subordinate AP can become a superior
	    AP of a called subordinate AP and so on or the superior AP can
	    trigger many subordinate APs
	  </para></listitem>
	  <listitem><para>
	    the diagram shows an example with only one Resource Manager for
	    every Application Program, but there's no restriction on
	    LIXA and XTA side, on the number of Resource Managers used by an
	    Application Program
	  </para></listitem>
	</itemizedlist>
      </para></important>
    </section>
    <section>
      <title>Example using C language</title>
      <para>
	The supplied examples (<filename>example_xta_macbpa01.c</filename> and
	<filename>example_xta_macbpa02.c</filename>) use
	PostgreSQL in the role of <quote>Resource Manager 2</quote> and MySQL
	(or MariaDB) in the role of <quote>Resource Manager 1</quote>; please
	refer to the instructions explained:
	<itemizedlist mark="bullet">
	  <listitem><para>
	    in <xref linkend="App_RM_Config_MySQL"/>
	    to set-up a running environment for MySQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="App_RM_Config_PostgreSQL"/>
	    to set-up a running environment for PostgreSQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="Starting_the_state_server"/>
	    to start up the LIXA state server.
	  </para></listitem>
	</itemizedlist>
	Both programs must be used to execute the example: 
	<filename>example_xta_macbpa01</filename> in the role of the superior
	Application Program (first AP) and
	<filename>example_xta_macbpa02</filename> in the role of the
	subordinate Application Program (second AP).
      </para>
      <para>
	Create a working directory in a place you are comfortable with:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	Copy files <filename>example_xta_macbas01.c</filename> and 
	<filename>example_xta_macbpa02.c</filename> in your working dir:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/example_xta_macbpa01.c .
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/example_xta_macbpa02.c .
	  </screen></td></tr></tbody>
	</table>
	Substitute <quote>X.Y.Z</quote> with the actual version of
	the software you installed.
      </para>
      <para>
	Compile and link the C example programs:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ . /opt/lixa/bin/lixa_env.sh
tiian@ubuntu1404-64:~/tmp$ gcc example_xta_macbpa01.c $(lixa-config -x -c -f -l -d) $(mysql_config --libs_r) -o example_xta_macbpa01
tiian@ubuntu1404-64:~/tmp$ gcc example_xta_macbpa02.c $(lixa-config -x -c -f -l -d) -lpq -o example_xta_macbpa02
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	If the previous steps worked for you, you should have two executable
	files of name <filename>example_xta_macbpa01</filename> and
	<filename>example_xta_macbpa02</filename> in your current directory:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l
total 96
-rwxrwxr-x 1 tiian tiian 18599 apr 11 22:52 example_xta_macbpa01
-rw-r--r-- 1 tiian tiian 10387 apr 11 22:52 example_xta_macbpa01.c
-rwxrwxr-x 1 tiian tiian 18525 apr 11 22:52 example_xta_macbpa02
-rw-r--r-- 1 tiian tiian 10537 apr 11 22:52 example_xta_macbpa02.c
	  </screen></td></tr></tbody>
	</table>
	The example programs accept four arguments:
	<itemizedlist mark="bullet">
          <listitem><para>
	    commit (or rollback): use <quote>1</quote> if you want to perform
	    a global commit or <quote>0</quote> if you want to perform a global
	    rollback
	  </para></listitem>
          <listitem><para>
	    insert (or delete): use <quote>1</quote> if you want to insert rows
	    in databases or <quote>0</quote> if you want to delete rows from
	    databases
	  </para></listitem>
          <listitem><para>
	    name of the FIFO (named pipe) that will be used to send messages
	    from the superior AP to the subordinate AP
	  </para></listitem>
          <listitem><para>
	    name of the FIFO (named pipe) that will be used to return messages
	    from the subordinate AP to the superior AP
	  </para></listitem>
	</itemizedlist>
      </para>
      <para>
	Open four terminal sessions: two for the example programs execution,
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbpa01
-rwxrwxr-x 1 tiian tiian 18599 apr 11 22:52 example_xta_macbpa01
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbpa02
-rwxrwxr-x 1 tiian tiian 18525 apr 11 22:52 example_xta_macbpa02
	  </screen></td></tr></tbody>
	</table>
	one for MySQL queries,
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 36
Server version: 5.5.59-0ubuntu0.14.04.1 (Ubuntu)

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql>
	  </screen></td></tr></tbody>
	</table>
	and one for PostgreSQL queries
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ psql testdb
psql (9.3.22)
Type "help" for help.

testdb=>
	  </screen></td></tr></tbody>
	</table>
	Set <varname>LIXA_PROFILE</varname> environment variable to
	<constant>XTA_DYN</constant>,
	a profile without static Resource Managers defined in
	<filename>lixac_conf.xml</filename>:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	create two named pipes (FIFO) to support communication between
	superior and subordinate Application Programs
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ mkfifo sup2sub
tiian@ubuntu1404-64:~/tmp$ mkfifo sub2sup
tiian@ubuntu1404-64:~/tmp$ ls -l su*
prw-rw-r-- 1 tiian tiian 0 apr  8 22:22 sub2sup
prw-rw-r-- 1 tiian tiian 0 apr  8 22:22 sup2sub
	  </screen></td></tr></tbody>
	</table>
	execute both the example programs to insert rows in tables and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbpa01 1 1 sup2sub sub2sup 
Superior AP has created a global transaction with XID '1279875137.23f76e42960242dabbbe0c79d701a710.e107cfeee0661d23da9322f1ee73faba'
Superior AP has sent XID '1279875137.23f76e42960242dabbbe0c79d701a710.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received XID '1279875137.23f76e42960242dabbbe0c79d701a710.e107cfeee0661d234a6a107d45254b67' from subordinate AP
MySQL, executing &gt;INSERT INTO authors VALUES(1919, 'Levi', 'Primo')&lt;
Superior AP has committed its branch
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbpa02 1 1 sup2sub sub2sup 
Subordinate AP has received XID '1279875137.23f76e42960242dabbbe0c79d701a710.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.23f76e42960242dabbbe0c79d701a710.e107cfeee0661d234a6a107d45254b67'
Subordinate AP has sent XID '1279875137.23f76e42960242dabbbe0c79d701a710.e107cfeee0661d234a6a107d45254b67' to superior AP
PostgreSQL, executing &gt;INSERT INTO authors VALUES(1921, 'Rigoni Stern', 'Mario')&lt;
Subordinate AP has committed its branch
	  </screen></td></tr></tbody>
	</table>
	<note>
	  <para>
	    The first (superior) Application Program suspends and waits the
	    return value from the second (subordinate) Application Program.
	  </para>
	  <para>
	    The XID generated by the subordinate AP differs from the XID
	    generated by the superior AP in the last 16 hexadecimal symbols
	    of the <quote>branch qualifier</quote>; the first 16 hexadecimal
	    symbols are the same: this is not required by XA specification but
	    can be useful for troubleshooting purposes.
	  </para>
	</note>
	Check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
1 row in set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	delete rows from tables, but rollback:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbpa01 0 0 sup2sub sub2sup 
Superior AP has created a global transaction with XID '1279875137.110e8d024d1c4137a189c50e005a3432.e107cfeee0661d23da9322f1ee73faba'
Superior AP has sent XID '1279875137.110e8d024d1c4137a189c50e005a3432.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received XID '1279875137.110e8d024d1c4137a189c50e005a3432.e107cfeee0661d238b40227da3dd406d' from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has rolled back its branch
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbpa02 0 0 sup2sub sub2sup 
Subordinate AP has received XID '1279875137.110e8d024d1c4137a189c50e005a3432.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.110e8d024d1c4137a189c50e005a3432.e107cfeee0661d238b40227da3dd406d'
Subordinate AP has sent XID '1279875137.110e8d024d1c4137a189c50e005a3432.e107cfeee0661d238b40227da3dd406d' to superior AP
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has rolled back its branch
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
1 row in set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	delete rows and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbpa01 1 0 sup2sub sub2sup 
Superior AP has created a global transaction with XID '1279875137.2a562ebe33654b4fa3d142569392ab13.e107cfeee0661d23da9322f1ee73faba'
Superior AP has sent XID '1279875137.2a562ebe33654b4fa3d142569392ab13.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received XID '1279875137.2a562ebe33654b4fa3d142569392ab13.e107cfeee0661d2396e0fac5217f44a8' from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has committed its branch
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbpa02 1 0 sup2sub sub2sup 
Subordinate AP has received XID '1279875137.2a562ebe33654b4fa3d142569392ab13.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.2a562ebe33654b4fa3d142569392ab13.e107cfeee0661d2396e0fac5217f44a8'
Subordinate AP has sent XID '1279875137.2a562ebe33654b4fa3d142569392ab13.e107cfeee0661d2396e0fac5217f44a8' to superior AP
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has committed its branch
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
Empty set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
(0 rows)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
      </para>
      <section>
	<title>Source Code</title>
	<para>
	  Source code for programs <filename>example_xta_macbpa01.c</filename> 
	  and <filename>example_xta_macbpa02.c</filename> are
	  installed in directory
	  <filename>/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta</filename> and
	  are available on <link xlink:href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/">GitHub</link>. Source code is fully
	  commented for readability.
	</para>
      </section>
    </section>
    <section>
      <title>Example using C++ language</title>
      <para>
	The supplied examples (<filename>example_xta_macbpa11.cpp</filename>
	and <filename>example_xta_macbpa12.cpp</filename>) use
	PostgreSQL in the role of <quote>Resource Manager 2</quote> and MySQL
	(or MariaDB) in the role of <quote>Resource Manager 1</quote>; please
	refer to the instructions explained:
	<itemizedlist mark="bullet">
	  <listitem><para>
	    in <xref linkend="App_RM_Config_MySQL"/>
	    to set-up a running environment for MySQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="App_RM_Config_PostgreSQL"/>
	    to set-up a running environment for PostgreSQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="Starting_the_state_server"/>
	    to start up the LIXA state server.
	  </para></listitem>
	</itemizedlist>
	Both programs must be used to execute the example: 
	<filename>example_xta_macbpa11</filename> in the role of the superior
	Application Program (first AP) and
	<filename>example_xta_macbpa12</filename> in the role of the
	subordinate Application Program (second AP).
      </para>
      <para>
	Create a working directory in a place you are comfortable with:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	Copy files <filename>example_xta_macbas11.cpp</filename> and 
	<filename>example_xta_macbpa12.cpp</filename> in your working dir:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/cpp/example_xta_macbpa11.cpp .
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/cpp/example_xta_macbpa12.cpp .
	  </screen></td></tr></tbody>
	</table>
	Substitute <quote>X.Y.Z</quote> with the actual version of
	the software you installed.
      </para>
      <para>
	Compile and link the C++ example programs:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ . /opt/lixa/bin/lixa_env.sh
tiian@ubuntu1404-64:~/tmp$ g++ example_xta_macbpa11.cpp $(lixa-config -c -f -l -d --xta --language-cpp) $(mysql_config --libs_r) -o example_xta_macbpa11
tiian@ubuntu1404-64:~/tmp$ g++ example_xta_macbpa12.cpp $(lixa-config -c -f -l -d --xta --language-cpp) -lpq -o example_xta_macbpa12
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	If the previous steps worked for you, you should have two executable
	files of name <filename>example_xta_macbpa11</filename> and
	<filename>example_xta_macbpa12</filename> in your current directory:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l
total 80
-rwxrwxr-x 1 tiian tiian 26419 ago 30 21:49 example_xta_macbpa11
-rw-r--r-- 1 tiian tiian  8305 ago 30 21:48 example_xta_macbpa11.cpp
-rwxrwxr-x 1 tiian tiian 26342 ago 30 21:49 example_xta_macbpa12
-rw-r--r-- 1 tiian tiian  8614 ago 30 21:49 example_xta_macbpa12.cpp
	  </screen></td></tr></tbody>
	</table>
	The example programs accept four arguments:
	<itemizedlist mark="bullet">
          <listitem><para>
	    commit (or rollback): use <quote>1</quote> if you want to perform
	    a global commit or <quote>0</quote> if you want to perform a global
	    rollback
	  </para></listitem>
          <listitem><para>
	    insert (or delete): use <quote>1</quote> if you want to insert rows
	    in databases or <quote>0</quote> if you want to delete rows from
	    databases
	  </para></listitem>
          <listitem><para>
	    name of the FIFO (named pipe) that will be used to send messages
	    from the superior AP to the subordinate AP
	  </para></listitem>
          <listitem><para>
	    name of the FIFO (named pipe) that will be used to return messages
	    from the subordinate AP to the superior AP
	  </para></listitem>
	</itemizedlist>
      </para>
      <para>
	Open four terminal sessions: two for the example programs execution,
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbpa11
-rwxrwxr-x 1 tiian tiian 26419 ago 30 21:49 example_xta_macbpa11
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbpa12
-rwxrwxr-x 1 tiian tiian 26342 ago 30 21:49 example_xta_macbpa12
	  </screen></td></tr></tbody>
	</table>
	one for MySQL queries,
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 36
Server version: 5.5.61-0ubuntu0.14.04.1 (Ubuntu)

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql>
	  </screen></td></tr></tbody>
	</table>
	and one for PostgreSQL queries
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ psql testdb
psql (9.3.24)
Type "help" for help.

testdb=>
	  </screen></td></tr></tbody>
	</table>
	Set <varname>LIXA_PROFILE</varname> environment variable to
	<constant>XTA_DYN</constant>,
	a profile without static Resource Managers defined in
	<filename>lixac_conf.xml</filename>:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	create two named pipes (FIFO) to support communication between
	superior and subordinate Application Programs
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ mkfifo sup2sub
tiian@ubuntu1404-64:~/tmp$ mkfifo sub2sup
tiian@ubuntu1404-64:~/tmp$ ls -l su*
prw-rw-r-- 1 tiian tiian 0 ago 30 21:55 sub2sup
prw-rw-r-- 1 tiian tiian 0 ago 30 21:55 sup2sub
	  </screen></td></tr></tbody>
	</table>
	execute both the example programs to insert rows in tables and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbpa11 1 1 sup2sub sub2sup
Superior AP has sent XID '1279875137.5aaef2e493c74a38a4547b446c859b1f.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received '1279875137.5aaef2e493c74a38a4547b446c859b1f.e107cfeee0661d236f20dd6b11f54de1' reply from subordinate AP
MySQL, executing &gt;INSERT INTO authors VALUES(1919, 'Levi', 'Primo')&lt;
Superior AP has committed its branch
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbpa12 1 1 sup2sub sub2sup 
Subordinate AP has received XID '1279875137.5aaef2e493c74a38a4547b446c859b1f.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.5aaef2e493c74a38a4547b446c859b1f.e107cfeee0661d236f20dd6b11f54de1'
Subordinate AP has returned '1279875137.5aaef2e493c74a38a4547b446c859b1f.e107cfeee0661d236f20dd6b11f54de1' to superior AP
PostgreSQL, executing &gt;INSERT INTO authors VALUES(1921, 'Rigoni Stern', 'Mario')&lt;
Subordinate AP has committed its branch
	  </screen></td></tr></tbody>
	</table>
	<note>
	  <para>
	    The first (superior) Application Program suspends and waits the
	    return value from the second (subordinate) Application Program.
	  </para>
	  <para>
	    The XID generated by the subordinate AP differs from the XID
	    generated by the superior AP in the last 16 hexadecimal symbols
	    of the <quote>branch qualifier</quote>; the first 16 hexadecimal
	    symbols are the same: this is not required by XA specification but
	    can be useful for troubleshooting purposes.
	  </para>
	</note>
	Check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
1 row in set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	delete rows from tables, but rollback:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbpa11 0 0 sup2sub sub2sup
Superior AP has sent XID '1279875137.64630ff1b9ed45a9be0d61591fbd0902.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received '1279875137.64630ff1b9ed45a9be0d61591fbd0902.e107cfeee0661d23b3d84907125644fb' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has rolled back its branch
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbpa12 0 0 sup2sub sub2sup 
Subordinate AP has received XID '1279875137.64630ff1b9ed45a9be0d61591fbd0902.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.64630ff1b9ed45a9be0d61591fbd0902.e107cfeee0661d23b3d84907125644fb'
Subordinate AP has returned '1279875137.64630ff1b9ed45a9be0d61591fbd0902.e107cfeee0661d23b3d84907125644fb' to superior AP
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has rolled back its branch
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
1 row in set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	delete rows and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbpa11 1 0 sup2sub sub2sup
Superior AP has sent XID '1279875137.026b900538d1419da4ab8d728519c75d.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received '1279875137.026b900538d1419da4ab8d728519c75d.e107cfeee0661d23158770b81d1b41b5' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has committed its branch
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbpa12 1 0 sup2sub sub2sup 
Subordinate AP has received XID '1279875137.026b900538d1419da4ab8d728519c75d.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.026b900538d1419da4ab8d728519c75d.e107cfeee0661d23158770b81d1b41b5'
Subordinate AP has returned '1279875137.026b900538d1419da4ab8d728519c75d.e107cfeee0661d23158770b81d1b41b5' to superior AP
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has committed its branch
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
Empty set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
(0 rows)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
      </para>
      <section>
	<title>Source Code</title>
	<para>
	  Source code for programs <filename>example_xta_macbpa11.cpp</filename> 
	  and <filename>example_xta_macbpa12.cpp</filename> are
	  installed in directory
	  <filename>/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/cpp</filename>
	  and are available on <link xlink:href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/cpp/">GitHub</link>. Source code is fully
	  commented for readability.
	</para>
      </section>
    </section>
    <section>
      <title>Example using Python language</title>
      <para>
	The supplied examples (<filename>example_xta_macbpa21.py</filename>
	and <filename>example_xta_macbpa22.py</filename>) use
	PostgreSQL in the role of <quote>Resource Manager 2</quote> and MySQL
	(or MariaDB) in the role of <quote>Resource Manager 1</quote>; please
	refer to the instructions explained:
	<itemizedlist mark="bullet">
	  <listitem><para>
	    in <xref linkend="XTA_Technology_Matrix"/>
	    to build and install the Python database drivers that can be used
	    with XTA
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="App_RM_Config_MySQL"/>
	    to set-up a running environment for MySQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="App_RM_Config_PostgreSQL"/>
	    to set-up a running environment for PostgreSQL server
	  </para></listitem>
	  <listitem><para>
	    in <xref linkend="Starting_the_state_server"/>
	    to start up the LIXA state server.
	  </para></listitem>
	</itemizedlist>
	Both programs must be used to execute the example: 
	<filename>example_xta_macbpa21.py</filename> in the role of the 
	superior Application Program (first AP) and
	<filename>example_xta_macbpa22.py</filename> in the role of the
	subordinate Application Program (second AP).
	Python 2 and Python 3 can be used even mixing them: one for the first
	AP and one for the second AP.
      </para>
      <para>
	Create a working directory in a place you are comfortable with:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </screen></td></tr></tbody>
	</table>
      </para>
      <para>
	Copy files <filename>example_xta_macbas21.py</filename> and 
	<filename>example_xta_macbpa22.py</filename> in your working dir:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/python/example_xta_macbpa21.py .
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/python/example_xta_macbpa22.py .
	  </screen></td></tr></tbody>
	</table>
	Substitute <quote>X.Y.Z</quote> with the actual version of
	the software you installed.
      </para>
      <para>
	The example programs accept four arguments:
	<itemizedlist mark="bullet">
          <listitem><para>
	    commit (or rollback): use <quote>1</quote> if you want to perform
	    a global commit or <quote>0</quote> if you want to perform a global
	    rollback
	  </para></listitem>
          <listitem><para>
	    insert (or delete): use <quote>1</quote> if you want to insert rows
	    in databases or <quote>0</quote> if you want to delete rows from
	    databases
	  </para></listitem>
          <listitem><para>
	    name of the FIFO (named pipe) that will be used to send messages
	    from the superior AP to the subordinate AP
	  </para></listitem>
          <listitem><para>
	    name of the FIFO (named pipe) that will be used to return messages
	    from the subordinate AP to the superior AP
	  </para></listitem>
	</itemizedlist>
      </para>
      <para>
	Open four terminal sessions: two for the example programs execution,
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbpa21.py 
-rw-r--r-- 1 tiian tiian 4595 ott 15 22:51 example_xta_macbpa21.py
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbpa22.py 
-rw-r--r-- 1 tiian tiian 4643 ott 15 22:52 example_xta_macbpa22.py
	  </screen></td></tr></tbody>
	</table>
	one for MySQL queries,
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 36
Server version: 5.5.61-0ubuntu0.14.04.1 (Ubuntu)

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql>
	  </screen></td></tr></tbody>
	</table>
	and one for PostgreSQL queries
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~$ psql testdb
psql (9.3.24)
Type "help" for help.

testdb=>
	  </screen></td></tr></tbody>
	</table>
	Set <varname>LIXA_PROFILE</varname> environment variable to
	<constant>XTA_DYN</constant>,
	a profile without static Resource Managers defined in
	<filename>lixac_conf.xml</filename>:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </screen></td></tr></tbody>
	</table>
	create two named pipes (FIFO) to support communication between
	superior and subordinate Application Programs
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ mkfifo sub2sup
tiian@ubuntu1404-64:~/tmp$ mkfifo sup2sub
tiian@ubuntu1404-64:~/tmp$ ls -l su*
prw-rw-r-- 1 tiian tiian 0 ott 15 22:54 sub2sup
prw-rw-r-- 1 tiian tiian 0 ott 15 22:54 sup2sub
	  </screen></td></tr></tbody>
	</table>
	execute both the example programs to insert rows in tables and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbpa21.py 1 1 sup2sub sub2sup
Superior AP has sent XID '1279875137.60142b5fab4b4f2ea4524778a3f983d8.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received '1279875137.60142b5fab4b4f2ea4524778a3f983d8.e107cfeee0661d23c14e2bfc4bc9495b' reply from subordinate AP
MySQL, executing &gt;INSERT INTO authors VALUES(1919, 'Levi', 'Primo')&lt;
Superior AP has committed its branch
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbpa22.py 1 1 sup2sub sub2sup 
Subordinate AP has received XID '1279875137.60142b5fab4b4f2ea4524778a3f983d8.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.60142b5fab4b4f2ea4524778a3f983d8.e107cfeee0661d23c14e2bfc4bc9495b'
Subordinate AP has returned '1279875137.60142b5fab4b4f2ea4524778a3f983d8.e107cfeee0661d23c14e2bfc4bc9495b' to superior AP
PostgreSQL, executing &gt;INSERT INTO authors VALUES(1921, 'Rigoni Stern', 'Mario')&lt;
Subordinate AP has committed its branch
	  </screen></td></tr></tbody>
	</table>
	<note>
	  <para>
	    The first (superior) Application Program suspends and waits the
	    return value from the second (subordinate) Application Program.
	  </para>
	  <para>
	    The XID generated by the subordinate AP differs from the XID
	    generated by the superior AP in the last 16 hexadecimal symbols
	    of the <quote>branch qualifier</quote>; the first 16 hexadecimal
	    symbols are the same: this is not required by XA specification but
	    can be useful for troubleshooting purposes.
	  </para>
	</note>
	Check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
1 row in set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	delete rows from tables, but rollback:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbpa21.py 0 0 sup2sub sub2sup
Superior AP has sent XID '1279875137.ef2a359d5fd048de872d9300f2ce3db9.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received '1279875137.ef2a359d5fd048de872d9300f2ce3db9.e107cfeee0661d233fda43cfc67242ec' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has rolled back its branch
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbpa22.py 0 0 sup2sub sub2sup 
Subordinate AP has received XID '1279875137.ef2a359d5fd048de872d9300f2ce3db9.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.ef2a359d5fd048de872d9300f2ce3db9.e107cfeee0661d233fda43cfc67242ec'
Subordinate AP has returned '1279875137.ef2a359d5fd048de872d9300f2ce3db9.e107cfeee0661d233fda43cfc67242ec' to superior AP
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has rolled back its branch
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
1 row in set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
	delete rows and commit:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP1]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbpa21.py 1 0 sup2sub sub2sup
Superior AP has sent XID '1279875137.8993e8485b5e4036ad5c536d1555f5a7.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received '1279875137.8993e8485b5e4036ad5c536d1555f5a7.e107cfeee0661d231e54035544b74771' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has committed its branch
	  </screen></td></tr></tbody>
	</table>
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - AP2]</td></tr></thead>
	  <tbody><tr><td><screen>
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbpa22.py 1 0 sup2sub sub2sup 
Subordinate AP has received XID '1279875137.8993e8485b5e4036ad5c536d1555f5a7.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.8993e8485b5e4036ad5c536d1555f5a7.e107cfeee0661d231e54035544b74771'
Subordinate AP has returned '1279875137.8993e8485b5e4036ad5c536d1555f5a7.e107cfeee0661d231e54035544b74771' to superior AP
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has committed its branch
	  </screen></td></tr></tbody>
	</table>
	check MySQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead>
	  <tbody><tr><td><screen>
mysql&gt; select * from authors;
Empty set (0.00 sec)

mysql&gt;
	  </screen></td></tr></tbody>
	</table>
	check PostgreSQL table content:
	<table frame="box">
	  <thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead>
	  <tbody><tr><td><screen>
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
(0 rows)

testdb=&gt;
	  </screen></td></tr></tbody>
	</table>
      </para>
      <section>
	<title>Source Code</title>
	<para>
	  Source code for programs <filename>example_xta_macbpa21.py</filename> 
	  and <filename>example_xta_macbpa22.py</filename> are
	  installed in directory
	  <filename>/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/python</filename>
	  and are available on <link xlink:href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/python/">GitHub</link>. Source code is fully
	  commented for readability.
	</para>
      </section>
    </section>
  </section>
</chapter>
